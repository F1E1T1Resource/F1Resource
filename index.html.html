<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F1 Resource - Firebase</title>
<style>
/* Styles same as before */
:root { --primary:#002b5c; --accent:#0b5fff; --card:#fff; --muted:#666; }
body { margin:0; font-family: Arial, sans-serif; background:#eef2f5; color:#0f1724; }
#loginScreen, #app { display:none; }
.centerBox { max-width:400px; margin:100px auto; padding:20px; background:var(--card); border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.1); }
input { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ccc; }
button { padding:10px 14px; background:var(--primary); color:#fff; border:none; border-radius:6px; cursor:pointer; }
#layout { display:flex; min-height:100vh; }
#sidebar { width:240px; background:var(--primary); color:#fff; padding:15px; }
#sidebar a { display:block; color:#fff; text-decoration:none; margin:8px 0; cursor:pointer; }
#sidebar a:hover { text-decoration:underline; }
#content { flex:1; padding:20px; }
.sectionCard { background:var(--card); padding:15px; border-radius:10px; margin-bottom:15px; box-shadow:0 4px 12px rgba(0,0,0,0.05); }
.listItem { background:#f9f9f9; padding:10px; border-radius:8px; margin-top:8px; display:flex; justify-content:space-between; align-items:center; border:1px solid #e0e0e0; }
.muted { color:var(--muted); font-size:13px; }
@media(max-width:900px){ #layout{flex-direction:column} #sidebar{width:100%;} }
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="centerBox">
  <h2>F1 Resource Login</h2>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p class="muted">Admin user: <strong>dlyboult</strong> / <strong>F1Resource</strong></p>
</div>

<!-- APP -->
<div id="app">
  <div id="layout">
    <aside id="sidebar">
      <h2>F1 Resource</h2>
      <div id="navLinks">
        <a onclick="showPage('home')">Home</a>
        <a onclick="showPage('countyResources')">County Resources</a>
        <a onclick="showPage('countyCoordinators')">County Coordinators</a>
        <a onclick="showPage('fireAgencies')">Fire Agencies</a>
        <a onclick="showPage('emsAgencies')">EMS Agencies</a>
        <a onclick="showPage('hazmatSearch')">HazMat Search</a>
        <a onclick="showPage('evSafety')">EV Safety</a>
      </div>
      <div id="adminLinks" style="margin-top:15px; display:none;">
        <strong>Admin:</strong>
        <a onclick="showPage('adminUsers')">Manage Users</a>
      </div>
    </aside>

    <main id="content">
      <!-- Pages (same as previous structure) -->
      <section id="home" class="page sectionCard"><h1>WELCOME</h1><p>This is <strong>F1 Resource</strong>, your all-inclusive app for resources in Oswego County.</p></section>
      <section id="countyResources" class="page sectionCard" style="display:none;"><div style="display:flex; justify-content:space-between; align-items:center;"><h2>County Resources</h2><button onclick="addResource()">Add Resource</button></div><div id="resourceList"></div></section>
      <section id="countyCoordinators" class="page sectionCard" style="display:none;"><div style="display:flex; justify-content:space-between; align-items:center;"><h2>County Coordinators</h2><button onclick="addCoordinator()">Add Coordinator</button></div><div id="coordinatorList"></div></section>
      <section id="fireAgencies" class="page sectionCard" style="display:none;"><div style="display:flex; justify-content:space-between; align-items:center;"><h2>Fire Agencies</h2><button onclick="addFireAgency()">Add Fire Agency</button></div><div id="fireList"></div></section>
      <section id="emsAgencies" class="page sectionCard" style="display:none;"><div style="display:flex; justify-content:space-between; align-items:center;"><h2>EMS Agencies</h2><button onclick="addEMSAgency()">Add EMS Agency</button></div><div id="emsList"></div></section>
      <section id="hazmatSearch" class="page sectionCard" style="display:none;"><h2>HazMat Search</h2><input id="unInput" placeholder="UN/NA number" style="width:50%; margin-bottom:10px;"><button onclick="lookupUN()">Search</button><div id="unResult"></div></section>
      <section id="evSafety" class="page sectionCard" style="display:none;"><h2>EV Safety</h2><p>Vehicle lookup not connected yet. Admin can add links in future.</p></section>
      <section id="adminUsers" class="page sectionCard" style="display:none;"><h2>Manage Users</h2><button onclick="addUser()">Add User</button><div id="userList"></div></section>
    </main>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue, push, update } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

/* --- FIREBASE CONFIG --- */
const firebaseConfig = {
  apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
  authDomain: "f1resource-8fedc.firebaseapp.com",
  databaseURL: "https://f1resource-8fedc-default-rtdb.firebaseio.com",
  projectId: "f1resource-8fedc",
  storageBucket: "f1resource-8fedc.firebasestorage.app",
  messagingSenderId: "182745701982",
  appId: "1:182745701982:web:9f4f3836b41b450987decf"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* --- Local Login --- */
const users = { 'dlyboult': { password:'F1Resource', role:'ADMIN' }, 'dept1': { password:'password', role:'DEPARTMENT' } };
let currentUser = null;

document.getElementById('loginScreen').style.display = 'block';
function login(){
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  if(!u||!p){ alert('Enter username/password'); return; }
  if(users[u] && users[u].password===p){
    currentUser = { username:u, role:users[u].role };
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('app').style.display='block';
    if(currentUser.role==='ADMIN') document.getElementById('adminLinks').style.display='block';
    loadData();
    showPage('home');
  } else { alert('Invalid credentials'); }
}

/* --- PAGE CONTROL --- */
function showPage(id){ document.querySelectorAll('.page').forEach(p=>p.style.display='none'); const el=document.getElementById(id); if(el) el.style.display='block'; }

/* --- LOAD DATA FROM FIREBASE --- */
let store = { resources:[], coordinators:[], fireAgencies:[], emsAgencies:[], hazmatDB:{} };

function loadData(){
  const dbRef = ref(db, 'appData');
  onValue(dbRef, (snapshot)=>{
    store = snapshot.val() || { resources:[], coordinators:[], fireAgencies:[], emsAgencies:[], hazmatDB:{} };
    renderAll();
  });
}

/* --- RENDER FUNCTIONS --- */
function renderAll(){ renderUsers(); renderResources(); renderCoordinators(); renderFire(); renderEMS(); }

function renderUsers(){ const t=document.getElementById('userList'); t.innerHTML=''; Object.keys(users).forEach(u=>{ const user=users[u]; const div=document.createElement('div'); div.className='listItem'; div.innerHTML=`<div><strong>${u}</strong> (${user.role})</div><div>${currentUser.role==='ADMIN'?`<button onclick="editUser('${u}')">Edit</button>`:''}</div>`; t.appendChild(div); }); }
function renderResources(){ const t=document.getElementById('resourceList'); t.innerHTML=''; store.resources.forEach((r,i)=>{ const div=document.createElement('div'); div.className='listItem'; div.innerHTML=`<div>${r.name}</div><div>${currentUser.role==='ADMIN'?`<button onclick="editResource(${i})">Edit</button>`:''}</div>`; t.appendChild(div); }); }
function renderCoordinators(){ const t=document.getElementById('coordinatorList'); t.innerHTML=''; store.coordinators.forEach((c,i)=>{ const div=document.createElement('div'); div.className='listItem'; div.innerHTML=`<div>${c.name}</div><div>${currentUser.role==='ADMIN'?`<button onclick="editCoordinator(${i})">Edit</button>`:''}</div>`; t.appendChild(div); }); }
function renderFire(){ const t=document.getElementById('fireList'); t.innerHTML=''; store.fireAgencies.forEach((f,i)=>{ const div=document.createElement('div'); div.className='listItem'; div.innerHTML=`<div>${f.name}</div><div>${currentUser.role==='ADMIN'||currentUser.username===f.owner?`<button onclick="editFire(${i})">Edit</button>`:''}</div>`; t.appendChild(div); }); }
function renderEMS(){ const t=document.getElementById('emsList'); t.innerHTML=''; store.emsAgencies.forEach((f,i)=>{ const div=document.createElement('div'); div.className='listItem'; div.innerHTML=`<div>${f.name}</div><div>${currentUser.role==='ADMIN'||currentUser.username===f.owner?`<button onclick="editEMS(${i})">Edit</button>`:''}</div>`; t.appendChild(div); }); }

/* --- ADD / EDIT (SYNC TO FIREBASE) --- */
function syncDB(){ set(ref(db,'appData'),store); }

function addUser(){ if(currentUser.role!=='ADMIN') return alert('Admin only'); const u=prompt('Username'); if(!u) return; const p=prompt('Password'); const role=prompt('Role (ADMIN/DEPARTMENT/TRIAL)','DEPARTMENT'); users[u]={password:p, role:role}; renderUsers(); }
function editUser(u){ if(currentUser.role!=='ADMIN') return; const p=prompt('New password', users[u].password); if(p) users[u].password=p; renderUsers(); }

function addResource(){ if(currentUser.role!=='ADMIN') return alert('Admin only'); const n=prompt('Resource name'); if(!n) return; const d=prompt('Details'); store.resources.push({name:n,details:d}); syncDB(); renderResources(); }
function editResource(i){ const r=store.resources[i]; const n=prompt('Resource name', r.name); if(n) r.name=n; const d=prompt('Details', r.details); if(d) r.details=d; syncDB(); renderResources(); }

function addCoordinator(){ if(currentUser.role!=='ADMIN') return alert('Admin only'); const n=prompt('Name'); if(!n) return; store.coordinators.push({name:n}); syncDB(); renderCoordinators(); }
function editCoordinator(i){ const c=store.coordinators[i]; const n=prompt('Name', c.name); if(n) c.name=n; syncDB(); renderCoordinators(); }

function addFireAgency(){ if(currentUser.role!=='ADMIN') return alert('Admin only'); const n=prompt('Agency name'); if(!n) return; store.fireAgencies.push({name:n,owner:currentUser.username}); syncDB(); renderFire(); }
function editFire(i){ const f=store.fireAgencies[i]; const n=prompt('Agency name', f.name); if(n) f.name=n; syncDB(); renderFire(); }

function addEMSAgency(){ if(currentUser.role!=='ADMIN') return alert('Admin only'); const n=prompt('Agency name'); if(!n) return; store.emsAgencies.push({name:n,owner:currentUser.username}); syncDB(); renderEMS(); }
function editEMS(i){ const f=store.emsAgencies[i]; const n=prompt('Agency name', f.name); if(n) f.name=n; syncDB(); renderEMS(); }

/* --- HazMat --- */
function lookupUN(){ const un=document.getElementById('unInput').value.trim(); const t=document.getElementById('unResult'); if(!un) return alert('Enter UN number'); const entry=store.hazmatDB[un]; if(!entry){ t.innerHTML='<p>Not found</p>'; return; } t.innerHTML=`<div><strong>${entry.name}</strong></div>`; }
</script>

</body>
</html>
