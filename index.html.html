<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F1 Resource</title>
<style>
  /* --- Variables --- */
  :root {
    --primary: #002b5c;
    --accent: #0b5fff;
    --muted: #6b7280;
    --card: #ffffff;
    --danger: #dc2626;
    --success: #16a34a;
  }

  body {
    margin: 0;
    font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
    background: #f1f5f9;
    color: #0f1724;
  }

  button {
    cursor: pointer;
    border-radius: 8px;
    border: none;
    padding: 10px 14px;
    font-size: 15px;
    background: var(--primary);
    color: #fff;
  }

  button.ghost {
    background: transparent;
    border: 1px solid var(--primary);
    color: var(--primary);
  }

  button.small {
    padding: 6px 10px;
    font-size: 13px;
  }

  input, select, textarea {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    font-size: 15px;
  }

  .centerBox {
    max-width: 480px;
    margin: 64px auto;
    padding: 26px;
    background: var(--card);
    border-radius: 12px;
    box-shadow: 0 6px 30px rgba(2,6,23,0.08);
  }

  #layout {
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  #sidebar {
    width: 260px;
    background: var(--primary);
    color: #fff;
    padding: 18px;
    transition: 0.25s;
    overflow-y: auto;
  }

  #sidebar.hidden {
    width: 0;
    padding: 0;
    overflow: hidden;
  }

  #sidebar h2 { margin:0 0 12px; font-size:18px; }
  #sidebar a { display:block; color:#fff; padding:10px 0; font-size:15px; text-decoration:none; cursor:pointer; }
  #sidebar a:hover { text-decoration: underline; }

  #content { flex:1; padding:20px; overflow-y:auto; }

  #toggleMenu {
    position: fixed;
    top: 12px;
    left: 12px;
    background: var(--primary);
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 8px;
    font-size: 18px;
    z-index: 50;
  }

  .sectionCard {
    background: var(--card);
    padding: 18px;
    border-radius: 12px;
    margin-bottom: 18px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.06);
  }

  .listItem {
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #eef2f5;
    margin-top: 8px;
    background: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }

  .muted { color: var(--muted); font-size: 13px; }

  @media (max-width: 900px){
    #layout { flex-direction: column; }
    #sidebar { width: 100%; position: fixed; left: 0; top: 0; transform: translateY(-150%); }
    #sidebar.show { transform: translateY(0); }
    #toggleMenu { position: fixed; left: 8px; top: 8px; }
  }
</style>
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen" class="centerBox" role="dialog" aria-modal="true">
  <h2>F1 Resource Login</h2>
  <div class="muted">Restricted to authorized fire department members</div>
  <input id="username" placeholder="Username" aria-label="Username">
  <input id="password" type="password" placeholder="Password" aria-label="Password">
  <div style="display:flex;gap:8px;margin-top:10px">
    <button onclick="login()">Login</button>
    <button class="ghost" onclick="showHelp()">Help</button>
  </div>
  <div class="muted" style="margin-top:12px">
    Admin: <strong>dlyboult</strong> / <strong>F1Resource</strong>
  </div>
</div>

<!-- App Layout -->
<div id="app" style="display:none">
  <button id="toggleMenu" onclick="toggleSidebar()">☰</button>
  <div id="layout">

    <!-- Sidebar -->
    <aside id="sidebar" aria-label="Main navigation">
      <h2>F1 Resource</h2>
      <div class="muted">Oswego County</div>
      <nav style="margin-top:16px">
        <a onclick="showPage('home')">Home</a>
        <a onclick="showPage('fireAgencies')">Fire Agencies</a>
        <a onclick="showPage('emsAgencies')">EMS Agencies</a>
        <a onclick="showPage('countyResources')">County Resources</a>
        <a onclick="showPage('countyCoordinators')">County Coordinators</a>
        <a onclick="showPage('hazmatSearch')">Hazardous Materials</a>
        <a onclick="showPage('evSafety')">EV Safety</a>
      </nav>
      <hr style="border:none;border-top:1px solid #0b2540;margin:14px 0" />
      <div id="adminControls" style="display:none">
        <div style="font-weight:700;margin-bottom:6px">Admin</div>
        <a onclick="showPage('manageUsers')">Manage Users</a>
      </div>
      <div style="margin-top:14px" class="muted">Version 1.0 — Online</div>
    </aside>

    <!-- Main Content -->
    <main id="content">

      <!-- Home -->
      <section id="home" class="page">
        <div class="sectionCard">
          <h1>WELCOME</h1>
          <div class="muted">This is <strong>F1 Resource</strong>, your all-inclusive app for Oswego County Fire Service resources.</div>
        </div>
      </section>

      <!-- Fire Agencies -->
      <section id="fireAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>Fire Agencies</h2>
            <div><button class="small" onclick="addFireAgency()">Add Fire Agency</button></div>
          </div>
          <div id="fireList" style="margin-top:12px"></div>
        </div>
      </section>

      <!-- EMS Agencies -->
      <section id="emsAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>EMS Agencies</h2>
            <div><button class="small" onclick="addEMSAgency()">Add EMS Agency</button></div>
          </div>
          <div id="emsList" style="margin-top:12px"></div>
        </div>
      </section>

      <!-- County Resources -->
      <section id="countyResources" class="page" style="display:none">
        <div class="sectionCard">
          <h2>County Resources</h2>
          <div><button class="small" onclick="addResource()">Add Resource</button></div>
          <div id="resourceList" style="margin-top:12px"></div>
        </div>
      </section>

      <!-- County Coordinators -->
      <section id="countyCoordinators" class="page" style="display:none">
        <div class="sectionCard">
          <h2>County Coordinators</h2>
          <div><button class="small" onclick="addCoordinator()">Add Coordinator</button></div>
          <div id="coordinatorList" style="margin-top:12px"></div>
        </div>
      </section>

      <!-- HazMat -->
      <section id="hazmatSearch" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Hazardous Material Search</h2>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
            <input id="unInput" placeholder="UN/NA number">
            <button onclick="lookupUN()">Search</button>
          </div>
          <div id="unResult" style="margin-top:12px"></div>
        </div>
      </section>

      <!-- EV Safety -->
      <section id="evSafety" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Electric Vehicle Safety</h2>
          <div class="muted">Preloaded manufacturer rescue info. Admin can update links.</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
            <input id="evVIN" placeholder="VIN">
            <input id="evPlate" placeholder="License Plate">
            <input id="evYMM" placeholder="Year,Make,Model">
            <button onclick="evSearch()">Search</button>
          </div>
          <div id="evResult" style="margin-top:12px"></div>
        </div>
      </section>

      <!-- Manage Users -->
      <section id="manageUsers" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Manage Users</h2>
          <div><button class="small" onclick="addUser()">Add User</button></div>
          <div id="userList" style="margin-top:12px"></div>
        </div>
      </section>

    </main>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, get, child, onValue, update } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
  authDomain: "f1resource-8fedc.firebaseapp.com",
  databaseURL: "https://f1resource-8fedc-default-rtdb.firebaseio.com",
  projectId: "f1resource-8fedc",
  storageBucket: "f1resource-8fedc.firebasestorage.app",
  messagingSenderId: "182745701982",
  appId: "1:182745701982:web:9f4f3836b41b450987decf"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* --- Local login --- */
let currentUser = null;
const users = { dlyboult: {password:'F1Resource', role:'ADMIN'} };

function login(){
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  if(!u || !p) { alert('Enter username/password'); return; }
  if(users[u] && users[u].password===p){
    currentUser = {username:u, role: users[u].role};
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('app').style.display='block';
    document.getElementById('adminControls').style.display=(currentUser.role==='ADMIN')?'block':'none';
    showPage('home');
    loadAllData();
  } else { alert('Invalid credentials'); }
}

function showHelp(){ alert('Admin user: dlyboult / F1Resource'); }
function toggleSidebar(){ const sb = document.getElementById('sidebar'); sb.classList.toggle('hidden'); }
function showPage(id){ document.querySelectorAll('.page').forEach(p=>p.style.display='none'); document.getElementById(id).style.display='block'; }

/* --- Data Handling --- */
function loadAllData(){
  const dbRef = ref(db, 'f1Resource');
  onValue(dbRef, (snapshot)=>{
    const data = snapshot.val() || {};
    renderFire(data.fireAgencies||[]);
    renderEMS(data.emsAgencies||[]);
    renderResources(data.resources||[]);
    renderCoordinators(data.coordinators||[]);
  });
}

function saveData(path, value){ set(ref(db, path), value); }

/* --- Render Functions (example for fire) --- */
function renderFire(list){
  const target = document.getElementById('fireList');
  target.innerHTML='';
  list.forEach(a=>{
    const div = document.createElement('div');
    div.className='listItem';
    div.innerHTML = `<div><strong>${a.name}</strong><div class='muted'>Battalion: ${a.battalion||'-'} • Stations: ${(a.stations||[]).join('; ')}</div></div>
      <div style="display:flex;gap:6px">
        <button class='small' onclick="editFire('${a.id}')">Edit</button>
        <button class='small' onclick="deleteFire('${a.id}')">Delete</button>
      </div>`;
    target.appendChild(div);
  });
}

function addFireAgency(){ alert('Add Fire Agency - To be implemented with nested apparatus'); }
function editFire(id){ alert('Edit Fire Agency - To be implemented'); }
function deleteFire(id){ alert('Delete Fire Agency - To be implemented'); }

function renderEMS(list){ console.log('Render EMS'); }
function renderResources(list){ console.log('Render Resources'); }
function renderCoordinators(list){ console.log('Render Coordinators'); }
function addUser(){ alert('Add User - Admin only'); }
function lookupUN(){ alert('HazMat Search - preloaded data'); }
function evSearch(){ alert('EV Search - preloaded data'); }
</script>
</body>
</html>
