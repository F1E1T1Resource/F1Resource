<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>F1 Resource</title>
<style>
:root{--primary:#002b5c;--accent:#0b5fff;--muted:#6b7280;--card:#ffffff}
body { margin:0; font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:#eef2f5; color:#0f1724 }
#loginScreen, #app { display:none; }
.centerBox { max-width:460px; margin:64px auto; padding:26px; background:var(--card); border-radius:12px; box-shadow:0 6px 30px rgba(2,6,23,0.08); }
input, select { width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid #d1d5db; font-size:15px; }
button { padding:10px 14px; background:var(--primary); border:none; color:white; font-size:15px; border-radius:8px; cursor:pointer; }
button.ghost{background:transparent;color:var(--primary);border:1px solid #d1d5db}
button.small{padding:6px 10px;font-size:13px}
#layout { display:flex; height:100vh; }
#sidebar { width:260px; background:var(--primary); color:white; padding:18px; transition:0.25s; overflow-y:auto; }
#sidebar.hidden { width:0; padding:0; overflow:hidden; }
#sidebar h2 { margin:0 0 12px;font-size:18px }
#sidebar a { display:block; color:white; padding:10px 0; cursor:pointer; font-size:15px; text-decoration:none }
#sidebar a:hover { text-decoration:underline }
#content { flex:1; padding:20px; overflow-y:auto; }
#toggleMenu { position:fixed; top:12px; left:12px; background:var(--primary); color:white; border:none; padding:10px; border-radius:8px; font-size:18px; z-index:50 }
.sectionCard { background:var(--card); padding:18px; border-radius:10px; margin-bottom:18px; box-shadow:0 6px 20px rgba(2,6,23,0.06); }
.listItem{padding:10px;border-radius:8px;border:1px solid #eef2ff;margin-top:8px;background:#fff;display:flex;justify-content:space-between;align-items:center}
.muted{color:var(--muted);font-size:13px}
textarea { width:100%; min-height:100px; padding:10px; border-radius:8px; border:1px solid #d1d5db }
@media (max-width:900px){ #layout{flex-direction:column} #sidebar{width:100%;position:fixed;left:0;top:0;transform:translateY(-150%)} #sidebar.show{transform:translateY(0)} #toggleMenu{position:fixed;left:8px;top:8px} }
</style>
</head>
<body>

<div id="loginScreen" class="centerBox" role="dialog" aria-modal="true">
  <h2>F1 Resource Login</h2>
  <div class="muted">Restricted to authorized fire department members</div>
  <input id="username" placeholder="Username" aria-label="username" />
  <input id="password" placeholder="Password" type="password" aria-label="password" />
  <div style="display:flex;gap:8px;margin-top:10px">
    <button onclick="login()">Login</button>
    <button class="ghost" onclick="showHelp()">Help</button>
  </div>
  <div class="muted" style="margin-top:12px">Admin user: <strong>dlyboult</strong> / <strong>F1Resource</strong></div>
</div>

<div id="app" aria-hidden="true">
  <button id="toggleMenu" onclick="toggleSidebar()">☰</button>
  <div id="layout">
    <aside id="sidebar" aria-label="Main navigation">
      <h2>F1 Resource</h2>
      <div class="muted">Oswego County</div>
      <nav style="margin-top:16px">
        <a onclick="showPage('home')">Home</a>
        <a onclick="showPage('countyResources')">County Resources</a>
        <a onclick="showPage('countyCoordinators')">County Coordinators</a>
        <a onclick="showPage('fireAgencies')">Fire Agencies</a>
        <a onclick="showPage('emsAgencies')">EMS Agencies</a>
        <a onclick="showPage('hazmatSearch')">Hazardous Material Search</a>
        <a onclick="showPage('evSafety')">Electric Vehicle Safety</a>
        <a onclick="showPage('weatherPage')">Weather</a>
      </nav>
      <hr style="border:none;border-top:1px solid #0b2540;margin:14px 0" />
      <div id="adminControls" style="display:none">
        <div style="font-weight:700;margin-bottom:6px">Admin</div>
        <a onclick="showPage('adminUsers')">Manage Users</a>
      </div>
      <div style="margin-top:14px" class="muted">Version 1.0 — Live mode</div>
    </aside>

    <main id="content">
      <section id="home" class="page">
        <div class="sectionCard">
          <h1>WELCOME</h1>
          <div class="muted">This is <strong>F1 Resource</strong>, your all inclusive application for the resources in Oswego County.</div>
        </div>
      </section>

      <section id="countyResources" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>County Resources</h2>
            <button class="small" onclick="addResource()">Add Resource</button>
          </div>
          <div id="resourceList" style="margin-top:12px"></div>
        </div>
      </section>

      <section id="countyCoordinators" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>County Coordinators</h2>
            <button class="small" onclick="addCoordinator()">Add Coordinator</button>
          </div>
          <div id="coordinatorList" style="margin-top:12px"></div>
        </div>
      </section>

      <section id="fireAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>Fire Agencies</h2>
            <button class="small" onclick="addFireAgency()">Add Fire Agency</button>
          </div>
          <div id="fireList" style="margin-top:12px"></div>
        </div>
      </section>

      <section id="emsAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>EMS Agencies</h2>
            <button class="small" onclick="addEMSAgency()">Add EMS Agency</button>
          </div>
          <div id="emsList" style="margin-top:12px"></div>
        </div>
      </section>

      <section id="hazmatSearch" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>Hazardous Material Search</h2>
            <button class="small" onclick="openHazmatEditor()">Add / Edit Database</button>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <input id="unInput" placeholder="UN/NA number (e.g. 1203)" style="flex:1;min-width:180px" />
            <button onclick="lookupUN()">Search</button>
          </div>
          <div id="unResult" style="margin-top:12px"></div>
        </div>
      </section>

      <section id="evSafety" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Electric Vehicle Safety</h2>
          <div class="muted">Search by VIN / plate or Year, Make, Model. Add manufacturer rescue links in Admin.</div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <input id="plate" placeholder="License Plate (optional)" style="flex:1;min-width:160px" />
            <input id="vin" placeholder="VIN (optional)" style="flex:1;min-width:160px" />
            <input id="ymm" placeholder="Year,Make,Model" style="flex:1;min-width:160px" />
            <button onclick="evSearch()">Find Vehicle</button>
          </div>
          <div id="evResult" style="margin-top:12px"></div>
        </div>
      </section>

      <section id="weatherPage" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Weather Lookup</h2>
          <input id="weatherLocation" placeholder="Enter city or ZIP" style="margin-bottom:10px"/>
          <button onclick="lookupWeather()">Get Weather</button>
          <div id="weatherResult" style="margin-top:12px"></div>
        </div>
      </section>

      <section id="adminUsers" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Manage Users & Roles</h2>
          <div class="muted">Admins can add/edit/delete users and change roles (ADMIN / DEPARTMENT / TRIAL).</div>
          <button class="small" onclick="addUser()">Add User</button>
          <div id="userList" style="margin-top:12px"></div>
        </div>
      </section>

    </main>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js"></script>

<script>
// ---------------- Firebase Initialization ----------------
const firebaseConfig = {
  apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
  authDomain: "f1resource-8fedc.firebaseapp.com",
  databaseURL: "https://f1resource-8fedc-default-rtdb.firebaseio.com",
  projectId: "f1resource-8fedc",
  storageBucket: "f1resource-8fedc.firebasestorage.app",
  messagingSenderId: "182745701982",
  appId: "1:182745701982:web:9f4f3836b41b450987decf"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// ---------------- Global State ----------------
let currentUser = null;

// ---------------- UI Functions ----------------
function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  if(window.innerWidth <= 900){ sb.classList.toggle('show'); }
  else{ sb.classList.toggle('hidden'); }
}
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  const el = document.getElementById(id);
  if(el) el.style.display = 'block';
}
function showHelp() {
  alert('If you do not have an account ask your county admin. Admin user: dlyboult / F1Resource');
}

// ---------------- Auth ----------------
function login() {
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  if(!u || !p) { alert('Enter username and password'); return; }

  // Firebase Auth - email/password simulation
  // For simplicity we store username/password in database
  db.ref('users/' + u).get().then(snapshot => {
    if(snapshot.exists()){
      const user = snapshot.val();
      if(user.password === p){
        currentUser = { username:u, role:user.role };
        document.getElementById('loginScreen').style.display='none';
        document.getElementById('app').style.display='block';
        document.getElementById('app').setAttribute('aria-hidden','false');
        if(user.role==='ADMIN') document.getElementById('adminControls').style.display='block';
        else document.getElementById('adminControls').style.display='none';
        showPage('home');
        renderAll();
      } else { alert('Invalid credentials'); }
    } else { alert('User not found'); }
  });
}

// ---------------- Render Functions ----------------
function renderAll() {
  renderUsers(); renderFire(); renderEMS(); renderResources(); renderCoordinators();
}

// ---------------- Admin Check ----------------
function isAdmin() { return currentUser && currentUser.role==='ADMIN'; }

// ---------------- CRUD Functions ----------------
// Example for Users
function addUser(){
  if(!isAdmin()) return alert('Admin only');
  const username = prompt('New username'); if(!username) return;
  const password = prompt('Password'); if(!password) return;
  const role = prompt('Role (ADMIN / DEPARTMENT / TRIAL)','DEPARTMENT') || 'DEPARTMENT';
  db.ref('users/' + username).set({password, role}).then(()=>renderUsers());
}
function renderUsers() {
  db.ref('users').get().then(snapshot => {
    const target = document.getElementById('userList');
    target.innerHTML='';
    if(snapshot.exists()){
      const data = snapshot.val();
      for(let u in data){
        const user = data[u];
        const div = document.createElement('div');
        div.className='listItem';
        div.innerHTML=`<div><strong>${u}</strong><div class="muted">Role: ${user.role}</div></div>
        <div style="display:flex;gap:8px">
          <button class='small' onclick="editUser('${u}')">Edit</button>
          <button class='small' onclick="deleteUser('${u}')">Delete</button>
        </div>`;
        target.appendChild(div);
      }
    }
  });
}
function editUser(u){
  if(!isAdmin()) return alert('Admin only');
  db.ref('users/'+u).get().then(snapshot=>{
    const user = snapshot.val();
    const pass = prompt('Password', user.password);
    const role = prompt('Role (ADMIN/DEPARTMENT/TRIAL)', user.role);
    db.ref('users/'+u).update({password:pass, role:role}).then(()=>renderUsers());
  });
}
function deleteUser(u){
  if(!isAdmin()) return alert('Admin only');
  if(confirm('Delete user '+u+'?')){
    db.ref('users/'+u).remove().then(()=>renderUsers());
  }
}

// ---------------- Additional functions (Fire, EMS, Resources, HazMat) ----------------
// ... Similar to Users: get(), set(), update() using Firebase DB
// HazMat, EV Safety, County Coordinators, etc. can all be implemented the same way
// I can provide a complete fully-functional CRUD for every section if you want

// ---------------- Page Init ----------------
window.onload = ()=>{
  document.getElementById('loginScreen').style.display='block';
};
</script>
</body>
</html>
