<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>F1 Resource</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#f5f5f5; }
    #loginBox { width:300px; margin:120px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2); }
    #app { display:none; min-height:100vh; }
    #sidebar { width:250px; background:#1a1a1a; color:white; padding:20px; position:fixed; top:0; bottom:0; left:0; overflow-y:auto; }
    #sidebar h2 { margin-top:0; }
    #sidebar button { width:100%; padding:10px; margin:5px 0; border:none; background:#333; color:white; border-radius:6px; text-align:left; }
    #content { margin-left:270px; padding:20px; }
    .hidden { display:none; }
    .card { background:white; padding:15px; border-radius:8px; margin:10px 0; box-shadow:0 0 5px rgba(0,0,0,0.1); }
    input, select, textarea { width:100%; padding:8px; margin:5px 0; border-radius:6px; border:1px solid #ccc; }
    @media(max-width:768px){
      #sidebar { width:100%; height:auto; position:relative; }
      #content { margin-left:0; }
    }
  </style>
</head>
<body>
  <!-- Login -->
  <div id="loginBox">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <!-- App -->
  <div id="app">
    <div id="sidebar">
      <h2>F1 Resource</h2>
      <button onclick="showPage('home')">Home</button>
      <button onclick="showPage('departments')">Fire Departments</button>
      <button onclick="showPage('ems')">EMS Agencies</button>
      <button onclick="showPage('resources')">County Resources</button>
      <button onclick="showPage('coordinators')">County Coordinators</button>
      <button onclick="showPage('hazmat')">HazMat Search</button>
      <button onclick="showPage('ev')">EV Safety</button>
      <button onclick="showPage('firerisk')">Fire Risk</button>
      <button onclick="showPage('drivingsafety')">Driving Safety</button>
    </div>

    <div id="content">
      <!-- Home -->
      <div id="home" class="page">
        <h1>Welcome</h1>
        <p>This is F1 Resource for Oswego County.</p>
        <div id="weatherWidget"><p>Weather Widget Here</p></div>
      </div>

      <!-- Departments -->
      <div id="departments" class="page hidden">
        <h2>Fire Departments</h2>
        <button onclick="addDepartment()">Add Department</button>
        <div id="departmentList"></div>
      </div>

      <!-- EMS -->
      <div id="ems" class="page hidden">
        <h2>EMS Agencies</h2>
        <button onclick="addEMS()">Add EMS Agency</button>
        <div id="emsList"></div>
      </div>

      <!-- Resources -->
      <div id="resources" class="page hidden">
        <h2>County Resources</h2>
        <button onclick="addResource()">Add Resource</button>
        <div id="resourceList"></div>
      </div>

      <!-- Coordinators -->
      <div id="coordinators" class="page hidden">
        <h2>County Coordinators</h2>
        <button onclick="addCoordinator()">Add Coordinator</button>
        <div id="coordinatorList"></div>
      </div>

      <!-- HazMat -->
      <div id="hazmat" class="page hidden">
        <h2>HazMat Search</h2>
        <input id="hazmatInput" placeholder="Enter UN Number">
        <button onclick="searchHazMat()">Search</button>
        <div id="hazmatResult"></div>
      </div>

      <!-- EV -->
      <div id="ev" class="page hidden">
        <h2>EV Safety</h2>
        <input id="evYM" placeholder="Year Make Model">
        <button onclick="searchEV()">Search</button>
        <div id="evResult"></div>
      </div>

      <!-- Fire Risk -->
      <div id="firerisk" class="page hidden">
        <h2>Fire Risk</h2>
        <p>Add your content here.</p>
      </div>

      <!-- Driving Safety -->
      <div id="drivingsafety" class="page hidden">
        <h2>Driving Safety</h2>
        <p>Add your content here.</p>
      </div>

    </div>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, setDoc, doc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
      authDomain: "f1resource-8fedc.firebaseapp.com",
      databaseURL: "https://f1resource-8fedc-default-rtdb.firebaseio.com",
      projectId: "f1resource-8fedc",
      storageBucket: "f1resource-8fedc.firebasestorage.app",
      messagingSenderId: "182745701982",
      appId: "1:182745701982:web:9f4f3836b41b450987decf"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Hidden local admin
    const LOCAL_ADMIN = { username: "ADMIN", password: "ADMIN", role: "admin" };

    let currentUser = null;

    // Login function
    window.login = async function() {
      const u = username.value.trim();
      const p = password.value.trim();
      if(u === LOCAL_ADMIN.username && p === LOCAL_ADMIN.password){
        currentUser = LOCAL_ADMIN;
        loginBox.style.display = "none";
        app.style.display = "flex";
        showPage('home');
        loadAll();
        return;
      }

      // Check Firestore users
      const usersCol = collection(db, "users");
      const usersSnap = await getDocs(usersCol);
      let found = false;
      usersSnap.forEach(docSnap => {
        const data = docSnap.data();
        if(data.username === u && data.password === p){
          currentUser = data;
          found = true;
        }
      });

      if(found){
        loginBox.style.display = "none";
        app.style.display = "flex";
        showPage('home');
        loadAll();
      } else {
        loginError.textContent = "Invalid login";
      }
    }

    // Show pages
    window.showPage = function(id){
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    // Load all collections
    async function loadAll(){
      loadCollection('departments', departmentList);
      loadCollection('ems', emsList);
      loadCollection('resources', resourceList);
      loadCollection('coordinators', coordinatorList);
    }

    async function loadCollection(colName, container){
      container.innerHTML = "";
      const colRef = collection(db, colName);
      const snap = await getDocs(colRef);
      snap.forEach(docSnap=>{
        const data = docSnap.data();
        const div = document.createElement('div');
        div.className = "card";
        div.innerHTML = `<strong>${data.name}</strong>`;
        container.appendChild(div);
      });
    }

    // Add functions
    window.addDepartment = async function(){
      const name = prompt("Department Name:");
      if(name) await addDoc(collection(db,"departments"), {name});
      loadAll();
    }
    window.addEMS = async function(){
      const name = prompt("EMS Agency Name:");
      if(name) await addDoc(collection(db,"ems"), {name});
      loadAll();
    }
    window.addResource = async function(){
      const name = prompt("Resource Name:");
      if(name) await addDoc(collection(db,"resources"), {name});
      loadAll();
    }
    window.addCoordinator = async function(){
      const name = prompt("Coordinator Name:");
      if(name) await addDoc(collection(db,"coordinators"), {name});
      loadAll();
    }

    // HazMat and EV placeholders
    window.searchHazMat = function(){
      const n = hazmatInput.value.trim();
      hazmatResult.innerHTML = `<p>HazMat info for UN ${n} (ERG 2024)</p>`;
    }
    window.searchEV = function(){
      const ym = evYM.value.trim();
      evResult.innerHTML = `<p>EV Safety info for ${ym} (NHTSA guide)</p>`;
    }

  </script>
</body>
</html>
