<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>F1 Resource</title>
<style>
  body { margin:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f0f2f5; }
  #loginBox { width:320px; margin:100px auto; padding:25px; background:white; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.2); text-align:center; }
  #loginBox h2 { margin-bottom:20px; color:#333; }
  #loginBox input { width:90%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc; }
  #loginBox button { padding:10px 20px; border:none; background:#007BFF; color:white; border-radius:6px; cursor:pointer; font-weight:bold; }
  #loginBox button:hover { background:#0056b3; }

  #app { display:none; min-height:100vh; display:flex; flex-direction:row; }
  #sidebar { width:250px; background:#1e1e2f; color:white; padding:20px; overflow-y:auto; transition:all 0.3s; flex-shrink:0; }
  #sidebar h2 { margin-top:0; margin-bottom:20px; font-size:1.5em; color:#FFD700; }
  #sidebar button { width:100%; padding:12px; margin:5px 0; border:none; background:#2c2c3e; color:white; border-radius:6px; text-align:left; cursor:pointer; transition:0.2s; }
  #sidebar button:hover { background:#444466; }

  #content { flex:1; padding:25px; overflow-y:auto; }
  .page { display:none; }
  .page.active { display:block; }
  .card { background:white; padding:15px; border-radius:10px; margin:10px 0; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
  input, select, textarea { width:100%; padding:10px; margin:5px 0; border-radius:6px; border:1px solid #ccc; }
  button.action { background:#28a745; color:white; border:none; padding:10px 15px; border-radius:6px; cursor:pointer; margin-top:5px; }
  button.action:hover { background:#1e7e34; }
  ul.list { list-style-type: disc; padding-left:20px; }

  #weatherAlerts { background:#ff4c4c; color:white; text-align:center; padding:10px; font-weight:bold; }
  
  @media(max-width:768px){
    #app { flex-direction:column; }
    #sidebar { width:100%; height:auto; position:relative; }
    #sidebar button { text-align:center; }
    #content { margin-left:0; padding:15px; }
  }
</style>
<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
  authDomain: "f1resource-8fedc.firebaseapp.com",
  databaseURL: "https://f1resource-8fedc-default-rtdb.firebaseio.com",
  projectId: "f1resource-8fedc",
  storageBucket: "f1resource-8fedc.firebasestorage.app",
  messagingSenderId: "182745701982",
  appId: "1:182745701982:web:9f4f3836b41b450987decf"
};

const appFirebase = initializeApp(firebaseConfig);
const db = getDatabase(appFirebase);

// Local login
const USERS = {
  "ADMIN": { password:"ADMIN", role:"admin" }
};

window.login = function() {
  const u = username.value.trim();
  const p = password.value.trim();
  if(USERS[u] && USERS[u].password === p){
    loginBox.style.display="none";
    app.style.display="flex";
    showPage('home');
    loadAllData();
    loadWeatherAlerts();
  } else {
    loginError.textContent="Invalid login";
  }
}

window.showPage = function(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// Firebase helper functions
function loadAllData(){
  loadData('departments', 'departmentList');
  loadData('ems', 'emsList');
  loadData('resources', 'resourceList');
  loadData('coordinators', 'coordinatorList');
}

function loadData(path, listId){
  const listRef = ref(db, path);
  onValue(listRef, (snapshot) => {
    const data = snapshot.val();
    const container = document.getElementById(listId);
    container.innerHTML = '';
    if(data){
      Object.entries(data).forEach(([key,val])=>{
        const card = document.createElement('div');
        card.className = 'card';
        let html = `<strong>${val.name || val.title}</strong>`;
        if(val.apparatus){
          html += '<ul class="list">';
          val.apparatus.split('|').forEach(item=>{
            html += `<li>${item.trim()}</li>`;
          });
          html += '</ul>';
        }
        html += `<br><button class="action" onclick="editItem('${path}','${key}')">Edit</button>`;
        html += ` <button class="action" onclick="deleteItem('${path}','${key}')">Delete</button>`;
        card.innerHTML = html;
        container.appendChild(card);
      });
    }
  });
}

window.addDepartment = function(){
  const name = prompt("Enter Department Name");
  const apparatus = prompt("Enter Apparatus (use | to separate items)");
  if(name){
    const newRef = push(ref(db,'departments'));
    set(newRef, {name, apparatus});
  }
}

window.addEMS = function(){
  const name = prompt("Enter EMS Name");
  const apparatus = prompt("Enter Apparatus (use | to separate items)");
  if(name){
    const newRef = push(ref(db,'ems'));
    set(newRef, {name, apparatus});
  }
}

window.addResource = function(){
  const name = prompt("Enter Resource Name");
  const apparatus = prompt("Enter Apparatus (use | to separate items)");
  if(name){
    const newRef = push(ref(db,'resources'));
    set(newRef, {title:name, apparatus});
  }
}

window.addCoordinator = function(){
  const name = prompt("Enter Coordinator Name");
  if(name){
    const newRef = push(ref(db,'coordinators'));
    set(newRef, {name});
  }
}

window.editItem = function(path,key){
  const itemRef = ref(db, `${path}/${key}`);
  onValue(itemRef,(snapshot)=>{
    const data = snapshot.val();
    const newName = prompt("Edit Name", data.name || data.title);
    const newApp = data.apparatus ? prompt("Edit Apparatus (use | to separate)", data.apparatus) : '';
    const updateObj = data.apparatus ? {name:newName, apparatus:newApp} : {title:newName};
    set(itemRef, updateObj);
  }, {once:true});
}

window.deleteItem = function(path,key){
  if(confirm("Are you sure you want to delete this item?")){
    remove(ref(db, `${path}/${key}`));
  }
}

// HazMat and EV placeholders
window.searchHazMat = function(){ hazmatResult.innerHTML=`<p>HazMat info for UN ${hazmatInput.value}</p>`; }
window.searchEV = function(){ evResult.innerHTML=`<p>EV info for ${evYM.value}</p>`; }

// Weather alerts
async function loadWeatherAlerts(){
  try{
    const res = await fetch('https://api.weather.gov/alerts/active?area=OSW'); // Oswego County
    const data = await res.json();
    const alertsDiv = document.getElementById('weatherAlerts');
    if(data.features && data.features.length>0){
      let html = '<strong>Active Weather Alerts:</strong> ';
      data.features.forEach(f=>{
        html += `${f.properties.event} | `;
      });
      alertsDiv.innerHTML = html.slice(0,-3);
    } else {
      alertsDiv.innerHTML = "No active weather alerts";
    }
  }catch(err){
    console.error(err);
  }
}
</script>
</head>
<body>
<div id="loginBox">
  <h2>Login</h2>
  <input id="username" placeholder="Username" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="login()">Login</button>
  <p id="loginError" style="color:red;"></p>
</div>

<div id="app">
  <div id="sidebar">
    <h2>F1 Resource</h2>
    <button onclick="showPage('home')">Home</button>
    <button onclick="showPage('departments')">Fire Departments</button>
    <button onclick="showPage('ems')">EMS Agencies</button>
    <button onclick="showPage('resources')">County Resources</button>
    <button onclick="showPage('coordinators')">County Coordinators</button>
    <button onclick="showPage('hazmat')">HazMat Search</button>
    <button onclick="showPage('ev')">EV Safety</button>
    <button onclick="showPage('fireRisk')">Fire Risk</button>
    <button onclick="showPage('drivingSafety')">Driving Safety</button>
  </div>

  <div id="content">
    <div id="weatherAlerts" class="card"></div>

    <div id="home" class="page active card">
      <h1>Welcome to F1 Resource</h1>
      <p>Your all-inclusive app for resources in Oswego County.</p>
    </div>

    <div id="departments" class="page card">
      <h2>Fire Departments</h2>
      <button class="action" onclick="addDepartment()">Add Department</button>
      <div id="departmentList"></div>
    </div>

    <div id="ems" class="page card">
      <h2>EMS Agencies</h2>
      <button class="action" onclick="addEMS()">Add EMS Agency</button>
      <div id="emsList"></div>
    </div>

    <div id="resources" class="page card">
      <h2>County Resources</h2>
      <button class="action" onclick="addResource()">Add Resource</button>
      <div id="resourceList"></div>
    </div>

    <div id="coordinators" class="page card">
      <h2>County Coordinators</h2>
      <button class="action" onclick="addCoordinator()">Add Coordinator</button>
      <div id="coordinatorList"></div>
    </div>

    <div id="hazmat" class="page card">
      <h2>HazMat Search</h2>
      <input id="hazmatInput" placeholder="Enter UN Number" />
      <button class="action" onclick="searchHazMat()">Search</button>
      <div id="hazmatResult"></div>
    </div>

    <div id="ev" class="page card">
      <h2>EV Safety</h2>
      <input id="evYM" placeholder="Year Make Model" />
      <button class="action" onclick="searchEV()">Search</button>
      <div id="evResult"></div>
    </div>

    <div id="fireRisk" class="page card">
      <h2>Fire Risk</h2>
      <p>Content goes here...</p>
    </div>

    <div id="drivingSafety" class="page card">
      <h2>Driving Safety</h2>
      <p>Content goes here...</p>
    </div>
  </div>
</div>
</body>
</html>
