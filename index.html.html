<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>F1 Resource</title>
<style>
:root{--primary:#002b5c;--accent:#0b5fff;--muted:#6b7280;--card:#ffffff}
body{margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:#eef2f5;color:#0f1724}
#loginScreen,#app{display:none}
.centerBox{max-width:460px;margin:64px auto;padding:26px;background:var(--card);border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.08);}
input,select,textarea{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid #d1d5db;font-size:15px;}
button{padding:10px 14px;background:var(--primary);border:none;color:white;font-size:15px;border-radius:8px;cursor:pointer;}
button.ghost{background:transparent;color:var(--primary);border:1px solid #d1d5db}
button.small{padding:6px 10px;font-size:13px}
#layout{display:flex;height:100vh;}
#sidebar{width:260px;background:var(--primary);color:white;padding:18px;transition:0.25s;overflow-y:auto;}
#sidebar.hidden{width:0;padding:0;overflow:hidden;}
#sidebar h2{margin:0 0 12px;font-size:18px}
#sidebar a{display:block;color:white;padding:10px 0;cursor:pointer;font-size:15px;text-decoration:none}
#sidebar a:hover{text-decoration:underline}
#content{flex:1;padding:20px;overflow-y:auto}
#toggleMenu{position:fixed;top:12px;left:12px;background:var(--primary);color:white;border:none;padding:10px;border-radius:8px;font-size:18px;z-index:50}
.sectionCard{background:var(--card);padding:18px;border-radius:10px;margin-bottom:18px;box-shadow:0 6px 20px rgba(2,6,23,0.06);}
.listItem{padding:10px;border-radius:8px;border:1px solid #eef2ff;margin-top:8px;background:#fff;display:flex;justify-content:space-between;align-items:center}
.muted{color:var(--muted);font-size:13px}
@media(max-width:900px){#layout{flex-direction:column}#sidebar{width:100%;position:fixed;left:0;top:0;transform:translateY(-150%)}#sidebar.show{transform:translateY(0)}#toggleMenu{position:fixed;left:8px;top:8px}}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen" class="centerBox" role="dialog" aria-modal="true">
  <h2>F1 Resource Login</h2>
  <div class="muted">Restricted to authorized fire department members</div>
  <input id="username" placeholder="Username" aria-label="username" />
  <input id="password" placeholder="Password" type="password" aria-label="password" />
  <div style="display:flex;gap:8px;margin-top:10px">
    <button onclick="login()">Login</button>
    <button class="ghost" onclick="showHelp()">Help</button>
  </div>
  <div class="muted" style="margin-top:12px">Admin user: <strong>dlyboult</strong> / <strong>F1Resource</strong></div>
</div>

<!-- MAIN APP -->
<div id="app" aria-hidden="true">
  <button id="toggleMenu" onclick="toggleSidebar()">☰</button>
  <div id="layout">
    <aside id="sidebar" aria-label="Main navigation">
      <h2>F1 Resource</h2>
      <div class="muted">Oswego County</div>
      <nav style="margin-top:16px">
        <a onclick="showPage('home')">Home</a>
        <a onclick="showPage('countyResources')">County Resources</a>
        <a onclick="showPage('countyCoordinators')">County Coordinators</a>
        <a onclick="showPage('fireAgencies')">Fire Agencies</a>
        <a onclick="showPage('emsAgencies')">EMS Agencies</a>
        <a onclick="showPage('hazmatSearch')">Hazardous Material Search</a>
        <a onclick="showPage('evSafety')">Electric Vehicle Safety</a>
      </nav>
      <hr style="border:none;border-top:1px solid #0b2540;margin:14px 0" />
      <div id="adminControls" style="display:none">
        <div style="font-weight:700;margin-bottom:6px">Admin</div>
        <a onclick="showPage('adminUsers')">Manage Users</a>
      </div>
      <div class="muted" style="margin-top:14px">Version 1.0 — Local mode</div>
    </aside>

    <main id="content">
      <section id="home" class="page">
        <div class="sectionCard">
          <h1>WELCOME</h1>
          <div class="muted">This is <strong>F1 Resource</strong>, your all-inclusive application for the resources in Oswego County.</div>
        </div>
      </section>

      <section id="countyResources" class="page" style="display:none">
        <div class="sectionCard">
          <h2>County Resources <button class="small" onclick="addResource()">Add Resource</button></h2>
          <div id="resourceList"></div>
        </div>
      </section>

      <section id="countyCoordinators" class="page" style="display:none">
        <div class="sectionCard">
          <h2>County Coordinators <button class="small" onclick="addCoordinator()">Add Coordinator</button></h2>
          <div id="coordinatorList"></div>
        </div>
      </section>

      <section id="fireAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Fire Agencies <button class="small" onclick="addFireAgency()">Add Fire Agency</button></h2>
          <div id="fireList"></div>
        </div>
      </section>

      <section id="emsAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <h2>EMS Agencies <button class="small" onclick="addEMSAgency()">Add EMS Agency</button></h2>
          <div id="emsList"></div>
        </div>
      </section>

      <section id="hazmatSearch" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Hazardous Material Search <button class="small" onclick="openHazmatEditor()">Edit DB</button></h2>
          <input id="unInput" placeholder="UN/NA number" />
          <input id="placardInput" placeholder="Placard number" />
          <button onclick="lookupUN()">Search</button>
          <div id="unResult"></div>
        </div>
      </section>

      <section id="evSafety" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Electric Vehicle Safety</h2>
          <input id="plate" placeholder="License Plate" />
          <input id="vin" placeholder="VIN" />
          <input id="ymm" placeholder="Year,Make,Model" />
          <button onclick="evSearch()">Find Vehicle</button>
          <div id="evResult"></div>
        </div>
      </section>

      <section id="adminUsers" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Manage Users & Roles <button class="small" onclick="addUser()">Add User</button></h2>
          <div id="userList"></div>
        </div>
      </section>

      <!-- DEPARTMENT SUB-PAGES -->
      <section id="deptSubPage" class="page" style="display:none">
        <div class="sectionCard">
          <h2 id="deptTitle"></h2>
          <div id="deptInfo"></div>
          <button class="small" id="editDeptBtn">Edit Department</button>
        </div>
      </section>

      <section id="emsSubPage" class="page" style="display:none">
        <div class="sectionCard">
          <h2 id="emsTitle"></h2>
          <div id="emsInfo"></div>
          <button class="small" id="editEmsBtn">Edit EMS Agency</button>
        </div>
      </section>

    </main>
  </div>
</div>

<script>
/* -------------------- Data Store -------------------- */
const STORAGE_KEY = 'f1_resource_data_v2';
let store = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
if(!store){
  store = {
    users:{'dlyboult':{password:'F1Resource',role:'ADMIN'}},
    resources:[],
    coordinators:[],
    fireAgencies:[],
    emsAgencies:[],
    hazmatDB:{},
    evDB:{}
  };
  localStorage.setItem(STORAGE_KEY,JSON.stringify(store));
}

function saveStore(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(store)); }

/* -------------------- Login -------------------- */
let currentUser=null;
function login(){
  const u=document.getElementById('username').value.trim();
  const p=document.getElementById('password').value.trim();
  const user=store.users[u];
  if(user && user.password===p){
    currentUser={username:u,role:user.role};
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('app').style.display='block';
    document.getElementById('app').setAttribute('aria-hidden','false');
    document.getElementById('adminControls').style.display=(user.role==='ADMIN')?'block':'none';
    showPage('home');
    renderAll();
  } else { alert('Invalid credentials'); }
}
function showHelp(){ alert('Ask your county admin for an account. Admin user: dlyboult / F1Resource'); }

/* -------------------- UI -------------------- */
function toggleSidebar(){
  const sb=document.getElementById('sidebar');
  if(window.innerWidth<=900){ sb.classList.toggle('show'); }
  else{ sb.classList.toggle('hidden'); }
}
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  const el=document.getElementById(id);
  if(el) el.style.display='block';
}

/* -------------------- Utilities -------------------- */
function uid(){ return 'id_'+Math.random().toString(36).slice(2,9); }
function isAdmin(){ return currentUser && currentUser.role==='ADMIN'; }

/* -------------------- Render Functions -------------------- */
function renderAll(){ renderUsers(); renderFire(); renderEMS(); renderResources(); renderCoordinators(); }

/* Users */
function renderUsers(){
  const target=document.getElementById('userList'); target.innerHTML='';
  Object.keys(store.users).forEach(u=>{
    const user=store.users[u];
    const div=document.createElement('div');
    div.className='listItem';
    div.innerHTML=`<div><strong>${u}</strong><div class="muted">Role: ${user.role}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="editUser('${u}')">Edit</button>
      <button class='small' onclick="deleteUser('${u}')">Delete</button></div>`;
    target.appendChild(div);
  });
}

/* Fire Agencies */
function renderFire(){
  const target=document.getElementById('fireList'); target.innerHTML='';
  store.fireAgencies.forEach(f=>{
    const div=document.createElement('div');
    div.className='listItem';
    div.innerHTML=`<div><strong>${f.name}</strong><div class='muted'>Battalion: ${f.battalion||'-'} • Stations: ${(f.stations||[]).join('; ')}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="openDeptSubPage('${f.id}')">View</button>
      <button class='small' onclick="editFire('${f.id}')">Edit</button>
      <button class='small' onclick="deleteFire('${f.id}')">Delete</button></div>`;
    target.appendChild(div);
  });
}

/* EMS Agencies */
function renderEMS(){
  const target=document.getElementById('emsList'); target.innerHTML='';
  store.emsAgencies.forEach(f=>{
    const div=document.createElement('div');
    div.className='listItem';
    div.innerHTML=`<div><strong>${f.name}</strong><div class='muted'>Stations: ${(f.stations||[]).join('; ')}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="openEmsSubPage('${f.id}')">View</button>
      <button class='small' onclick="editEms('${f.id}')">Edit</button>
      <button class='small' onclick="deleteEms('${f.id}')">Delete</button></div>`;
    target.appendChild(div);
  });
}

/* County Resources */
function renderResources(){
  const target=document.getElementById('resourceList'); target.innerHTML='';
  store.resources.forEach(r=>{
    const div=document.createElement('div'); div.className='listItem';
    div.innerHTML=`<div><strong>${r.name}</strong><div class='muted'>${r.capabilities||r.details||''}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="editResource('${r.id}')">Edit</button>
      <button class='small' onclick="deleteResource('${r.id}')">Delete</button></div>`;
    target.appendChild(div);
  });
}

/* County Coordinators */
function renderCoordinators(){
  const target=document.getElementById('coordinatorList'); target.innerHTML='';
  store.coordinators.forEach(c=>{
    const div=document.createElement('div'); div.className='listItem';
    div.innerHTML=`<div><strong>${c.name}</strong><div class='muted'>Callsign: ${c.callsign||''}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="editCoordinator('${c.id}')">Edit</button>
      <button class='small' onclick="deleteCoordinator('${c.id}')">Delete</button></div>`;
    target.appendChild(div);
  });
}

/* -------------------- CRUD -------------------- */
/* Users */
function addUser(){ if(!isAdmin()) return; const username=prompt('New username:'); if(!username) return; const pass=prompt('Password:'); const role=prompt('Role (ADMIN/DEPARTMENT/TRIAL)','DEPARTMENT'); store.users[username]={password:pass||'changeme',role:role||'DEPARTMENT'}; saveStore(); renderUsers(); alert('User added'); }
function editUser(u){ if(!isAdmin()) return; const user=store.users[u]; if(!user) return; const pass=prompt('New password',user.password); const role=prompt('Role',user.role); if(pass) user.password=pass; if(role) user.role=role; saveStore(); renderUsers(); }
function deleteUser(u){ if(!isAdmin()) return; if(!confirm('Delete user '+u+'?')) return; delete store.users[u]; saveStore(); renderUsers(); }

/* Fire Agency CRUD */
function addFireAgency(){ if(!isAdmin()) return; const name=prompt('Agency name'); if(!name) return; const battalion=prompt('Battalion'); const stations=prompt('Stations | separated'); const apparatus=prompt('Apparatus | separated'); const id=uid(); store.fireAgencies.push({id,name,battalion,stations:stations?stations.split('|').map(s=>s.trim()):[],apparatus:apparatus?apparatus.split('|').map(s=>s.trim()):[]}); saveStore(); renderFire(); }
function editFire(id){ if(!isAdmin()) return; const f=store.fireAgencies.find(x=>x.id===id); if(!f) return; f.name=prompt('Agency name',f.name)||f.name; f.battalion=prompt('Battalion',f.battalion)||f.battalion; const stations=prompt('Stations', (f.stations||[]).join('|')); f.stations=stations?stations.split('|').map(s=>s.trim()):[]; const app=prompt('Apparatus', (f.apparatus||[]).join('|')); f.apparatus=app?app.split('|').map(s=>s.trim()):[]; saveStore(); renderFire(); }
function deleteFire(id){ if(!isAdmin()) return; if(!confirm('Delete agency?')) return; store.fireAgencies=store.fireAgencies.filter(x=>x.id!==id); saveStore(); renderFire(); }

/* EMS CRUD */
function addEMSAgency(){ if(!isAdmin()) return; const name=prompt('EMS agency name'); if(!name) return; const stations=prompt('Stations | separated'); const id=uid(); store.emsAgencies.push({id,name,stations:stations?stations.split('|').map(s=>s.trim()):[]}); saveStore(); renderEMS(); }
function editEms(id){ if(!isAdmin()) return; const f=store.emsAgencies.find(x=>x.id===id); if(!f) return; f.name=prompt('Agency name',f.name)||f.name; const stations=prompt('Stations', (f.stations||[]).join('|')); f.stations=stations?stations.split('|').map(s=>s.trim()):[]; saveStore(); renderEMS(); }
function deleteEms(id){ if(!isAdmin()) return; if(!confirm('Delete agency?')) return; store.emsAgencies=store.emsAgencies.filter(x=>x.id!==id); saveStore(); renderEMS(); }

/* Department sub-page */
function openDeptSubPage(id){
  const f=store.fireAgencies.find(x=>x.id===id); if(!f) return;
  showPage('deptSubPage'); document.getElementById('deptTitle').innerText=f.name;
  document.getElementById('deptInfo').innerHTML=`<p><strong>Battalion:</strong> ${f.battalion||'-'}</p>
    <p><strong>Stations:</strong> ${(f.stations||[]).join(', ')}</p>
    <p><strong>Apparatus:</strong> ${(f.apparatus||[]).map(a=>a+' (IN SERVICE)').join(', ')}</p>`;
  document.getElementById('editDeptBtn').onclick=function(){ editFire(id); openDeptSubPage(id); };
}
function openEmsSubPage(id){
  const f=store.emsAgencies.find(x=>x.id===id); if(!f) return;
  showPage('emsSubPage'); document.getElementById('emsTitle').innerText=f.name;
  document.getElementById('emsInfo').innerHTML=`<p><strong>Stations:</strong> ${(f.stations||[]).join(', ')}</p>`;
  document.getElementById('editEmsBtn').onclick=function(){ editEms(id); openEmsSubPage(id); };
}

/* Placeholder functions */
function addResource(){ if(!isAdmin()) return alert('Add resource'); }
function addCoordinator(){ if(!isAdmin()) return alert('Add coordinator'); }
function lookupUN(){ alert('UN Search not implemented'); }
function openHazmatEditor(){ if(!isAdmin()) alert('Admin-only'); else alert('HazMat Editor'); }
function evSearch(){ alert('EV Safety Lookup not implemented'); }
</script>

</body>
</html>
