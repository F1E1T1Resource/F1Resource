<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F1 Resource</title>
<style>
:root{--primary:#002b5c;--accent:#0b5fff;--muted:#6b7280;--card:#ffffff;}
body{margin:0;font-family:Inter,sans-serif;background:#eef2f5;color:#0f1724;}
#loginScreen,#app{display:none;}
.centerBox{max-width:460px;margin:64px auto;padding:26px;background:var(--card);border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.08);}
input,select,textarea{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid #d1d5db;font-size:15px;}
button{padding:10px 14px;background:var(--primary);border:none;color:white;font-size:15px;border-radius:8px;cursor:pointer;}
button.ghost{background:transparent;color:var(--primary);border:1px solid #d1d5db;}
button.small{padding:6px 10px;font-size:13px;}
#layout{display:flex;height:100vh;}
#sidebar{width:260px;background:var(--primary);color:white;padding:18px;transition:0.25s;overflow-y:auto;}
#sidebar.hidden{width:0;padding:0;overflow:hidden;}
#sidebar h2{margin:0 0 12px;font-size:18px;}
#sidebar a{display:block;color:white;padding:10px 0;cursor:pointer;font-size:15px;text-decoration:none;}
#sidebar a:hover{text-decoration:underline;}
#content{flex:1;padding:20px;overflow-y:auto;}
#toggleMenu{position:fixed;top:12px;left:12px;background:var(--primary);color:white;border:none;padding:10px;border-radius:8px;font-size:18px;z-index:50;}
.sectionCard{background:var(--card);padding:18px;border-radius:10px;margin-bottom:18px;box-shadow:0 6px 20px rgba(2,6,23,0.06);}
.listItem{padding:10px;border-radius:8px;border:1px solid #eef2ff;margin-top:8px;background:#fff;display:flex;justify-content:space-between;align-items:center;}
.muted{color:var(--muted);font-size:13px;}
@media (max-width:900px){#layout{flex-direction:column}#sidebar{width:100%;position:fixed;left:0;top:0;transform:translateY(-150%)}#sidebar.show{transform:translateY(0)}#toggleMenu{position:fixed;left:8px;top:8px}}
</style>
</head>
<body>

<div id="loginScreen" class="centerBox">
  <h2>F1 Resource Login</h2>
  <div class="muted">Restricted to authorized fire department members</div>
  <input id="username" placeholder="Username"/>
  <input id="password" placeholder="Password" type="password"/>
  <div style="display:flex;gap:8px;margin-top:10px">
    <button onclick="login()">Login</button>
    <button class="ghost" onclick="showHelp()">Help</button>
  </div>
  <div class="muted" style="margin-top:12px">Admin user created: <strong>dlyboult</strong> / <strong>F1Resource</strong></div>
</div>

<div id="app" aria-hidden="true">
  <button id="toggleMenu" onclick="toggleSidebar()">☰</button>
  <div id="layout">
    <aside id="sidebar">
      <h2>F1 Resource</h2>
      <div class="muted">Oswego County</div>
      <nav style="margin-top:16px">
        <a onclick="showPage('home')">Home</a>
        <a onclick="showPage('countyResources')">County Resources</a>
        <a onclick="showPage('countyCoordinators')">County Coordinators</a>
        <a onclick="showPage('fireAgencies')">Fire Agencies</a>
        <a onclick="showPage('emsAgencies')">EMS Agencies</a>
        <a onclick="showPage('hazmatSearch')">Hazardous Material Search</a>
        <a onclick="showPage('evSafety')">Electric Vehicle Safety</a>
      </nav>
      <hr style="border:none;border-top:1px solid #0b2540;margin:14px 0" />
      <div id="adminControls" style="display:none">
        <div style="font-weight:700;margin-bottom:6px">Admin</div>
        <a onclick="showPage('adminUsers')">Manage Users</a>
      </div>
      <div style="margin-top:14px" class="muted">Version 1.0 — Local mode</div>
    </aside>

    <main id="content">

      <section id="home" class="page">
        <div class="sectionCard">
          <h1>WELCOME</h1>
          <div class="muted">This is <strong>F1 Resource</strong>, your all inclusive application for the resources in Oswego County.</div>
        </div>
      </section>

      <section id="countyResources" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>County Resources</h2>
            <button class="small" onclick="addResource()">Add Resource</button>
          </div>
          <div id="resourceList"></div>
        </div>
      </section>

      <section id="countyCoordinators" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>County Coordinators</h2>
            <button class="small" onclick="addCoordinator()">Add Coordinator</button>
          </div>
          <div id="coordinatorList"></div>
        </div>
      </section>

      <section id="fireAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>Fire Agencies</h2>
            <button class="small" onclick="addFireAgency()">Add Fire Agency</button>
          </div>
          <div id="fireList"></div>
        </div>
      </section>

      <section id="emsAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>EMS Agencies</h2>
            <button class="small" onclick="addEMSAgency()">Add EMS Agency</button>
          </div>
          <div id="emsList"></div>
        </div>
      </section>

      <section id="hazmatSearch" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Hazardous Material Search</h2>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
            <input id="unInput" placeholder="UN/NA number" style="flex:1;min-width:180px"/>
            <input id="placardInput" placeholder="Placard number" style="width:160px"/>
            <button onclick="lookupUN()">Search</button>
          </div>
          <div id="unResult" style="margin-top:12px"></div>
        </div>
      </section>

      <section id="evSafety" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Electric Vehicle Safety</h2>
          <div class="muted" style="margin-top:8px">Search by VIN / plate or Year, Make, Model. Admin can add/edit vehicle entries.</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
            <input id="plate" placeholder="License Plate (optional)" style="flex:1;min-width:160px"/>
            <input id="vin" placeholder="VIN (optional)" style="flex:1;min-width:160px"/>
            <input id="ymm" placeholder="Year,Make,Model" style="flex:1;min-width:160px"/>
            <button onclick="evSearch()">Find Vehicle</button>
          </div>
          <div id="evResult" style="margin-top:12px"></div>
        </div>
      </section>

      <section id="adminUsers" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Manage Users & Roles</h2>
          <div class="muted">Admins can add/edit/delete users and change roles (ADMIN / DEPARTMENT / TRIAL).</div>
          <button class="small" onclick="addUser()">Add User</button>
          <div id="userList" style="margin-top:12px"></div>
        </div>
      </section>

    </main>
  </div>
</div>

<script>
// Single flat local DB preloaded
let store = JSON.parse(localStorage.getItem('f1_resource_data')) || {
  users: { 'dlyboult': { password:'F1Resource', role:'ADMIN' } },
  resources: [], coordinators: [], fireAgencies: [], emsAgencies: [],
  hazmatDB: { 
    "1203": {un:"1203",name:"Gasoline",hazard_class:"3-Flammable",flammability:"Highly flammable",flash_point:"-43C",water_reactivity:"Floats on water",extinguishing_agent:"Foam, dry chemical",ppe:"Full turnout, SCBA",health_effects:"Irritation, CNS depression",reactivity:"Reactive with strong oxidizers",evacuation_small:"100m",evacuation_large:"800m",notes:"Vapors heavier than air"},
    "1017": {un:"1017",name:"Chlorine",hazard_class:"2.3-Toxic/Corrosive Gas",flammability:"Not flammable",flash_point:"N/A",water_reactivity:"Reacts violently with water",extinguishing_agent:"Evacuate area",ppe:"SCBA & chemical suit",health_effects:"Respiratory damage",reactivity:"Reacts with ammonia, hydrocarbons",evacuation_small:"25m",evacuation_large:"800m",notes:"Highly toxic"}
  },
  evDB: {
    "TESLA-2023-MODEL3": {vin:"5YJ3E1EA7KF317XXX",year:"2023",make:"Tesla",model:"Model 3",info:"Manufacturer rescue guide link here"}
  }
};
function saveStore(){localStorage.setItem('f1_resource_data',JSON.stringify(store));}

// --- Login ---
let currentUser = null;
function login(){
  const u=document.getElementById('username').value.trim();
  const p=document.getElementById('password').value.trim();
  if(!u||!p){alert('Enter username and password'); return;}
  const user = store.users[u];
  if(user&&user.password===p){
    currentUser={username:u,role:user.role};
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('app').style.display='block';
    if(user.role==='ADMIN') document.getElementById('adminControls').style.display='block';
    else document.getElementById('adminControls').style.display='none';
    showPage('home'); renderAll();
  } else {alert('Invalid credentials');}
}
function showHelp(){alert('Ask your county admin. Admin user: dlyboult / F1Resource');}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('hidden');}
function showPage(id){document.querySelectorAll('.page').forEach(p=>p.style.display='none'); document.getElementById(id).style.display='block';}

// --- Render lists ---
function renderAll(){renderUsers(); renderFire(); renderEMS(); renderResources(); renderCoordinators();}
function renderUsers(){const t=document.getElementById('userList'); t.innerHTML=''; Object.keys(store.users).forEach(u=>{const user=store.users[u]; const div=document.createElement('div'); div.className='listItem'; div.innerHTML=`<div><strong>${u}</strong><div class='muted'>Role: ${user.role}</div></div><div style="display:flex;gap:8px"><button class='small' onclick="editUser('${u}')">Edit</button><button class='small' onclick="deleteUser('${u}')">Delete</button></div>`; t.appendChild(div);});}
function renderResources(){const t=document.getElementById('resourceList'); t.innerHTML=''; store.resources.forEach(r=>{const div=document.createElement('div');div.className='listItem';div.innerHTML=`<div><strong>${r.name}</strong><div class='muted'>${r.capabilities||''}</div></div><div style="display:flex;gap:8px"><button class='small' onclick="editResource('${r.id}')">Edit</button><button class='small' onclick="deleteResource('${r.id}')">Delete</button></div>`;t.appendChild(div);});}
function renderCoordinators(){const t=document.getElementById('coordinatorList'); t.innerHTML=''; store.coordinators.forEach(c=>{const div=document.createElement('div');div.className='listItem';div.innerHTML=`<div><strong>${c.name}</strong><div class='muted'>Callsign: ${c.callsign||''}</div></div><div style="display:flex;gap:8px"><button class='small' onclick="editCoordinator('${c.id}')">Edit</button><button class='small' onclick="deleteCoordinator('${c.id}')">Delete</button></div>`; t.appendChild(div);});}
function renderFire(){const t=document.getElementById('fireList'); t.innerHTML=''; store.fireAgencies.forEach(a=>{const div=document.createElement('div');div.className='listItem';div.innerHTML=`<div><strong>${a.name}</strong><div class='muted'>Battalion: ${a.battalion||'-'} • Stations: ${(a.stations||[]).join('; ')}</div></div><div style="display:flex;gap:8px"><button class='small' onclick="editFire('${a.id}')">Edit</button><button class='small' onclick="deleteFire('${a.id}')">Delete</button></div>`; t.appendChild(div);});}
function renderEMS(){const t=document.getElementById('emsList'); t.innerHTML=''; store.emsAgencies.forEach(a=>{const div=document.createElement('div');div.className='listItem';div.innerHTML=`<div><strong>${a.name}</strong><div class='muted'>${(a.stations||[]).join('; ')}</div></div><div style="display:flex;gap:8px"><button class='small' onclick="editEms('${a.id}')">Edit</button><button class='small' onclick="deleteEms('${a.id}')">Delete</button></div>`; t.appendChild(div);});}

// --- CRUD Helpers ---
function isAdmin(){return currentUser&&currentUser.role==='ADMIN';}

// Add/Edit/Delete users, resources, coordinators, fire/ems similar to previous examples
// Lookup HazMat
function lookupUN(){const q=document.getElementById('unInput').value.trim();const e=store.hazmatDB[q];const t=document.getElementById('unResult'); if(!e){t.innerHTML=`<div class='sectionCard'><strong>Not found</strong></div>`;return;} t.innerHTML=`<div class='sectionCard'><h3>${e.name} (UN ${e.un})</h3><div><strong>Class:</strong> ${e.hazard_class}</div><div><strong>Flammability:</strong> ${e.flammability}</div><div><strong>Flash Point:</strong> ${e.flash_point}</div><div><strong>Water Reactivity:</strong> ${e.water_reactivity}</div><div><strong>Extinguishing Agent:</strong> ${e.extinguishing_agent}</div><div><strong>PPE:</strong> ${e.ppe}</div><div><strong>Health Effects:</strong> ${e.health_effects}</div><div><strong>Reactivity:</strong> ${e.reactivity}</div><div><strong>Evacuation Small:</strong> ${e.evacuation_small}</div><div><strong>Evacuation Large:</strong> ${e.evacuation_large}</div><div><strong>Notes:</strong> ${e.notes}</div></div>`;}

// EV Search
function evSearch(){const v=document.getElementById('vin').value.trim();const p=document.getElementById('plate').value.trim();const y=document.getElementById('ymm').value.trim();const t=document.getElementById('evResult');t.innerHTML='';for(const k in store.evDB){const ev=store.evDB[k];if(ev.vin===v||k===p||(`${ev.year},${ev.make},${ev.model}`===y)){t.innerHTML=`<div class='sectionCard'><h3>${ev.year} ${ev.make} ${ev.model}</h3><div>${ev.info}</div></div>`;return;} } t.innerHTML=`<div class='sectionCard'><strong>Not found</strong></div>`;}

document.addEventListener('DOMContentLoaded',()=>{document.getElementById('loginScreen').style.display='block';});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Show login screen on page load
  document.getElementById('loginScreen').style.display = 'block';
  document.getElementById('app').style.display = 'none';
});
</script>
</body>
</html>

