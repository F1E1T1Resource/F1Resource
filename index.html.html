<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F1 Resource</title>
<script type="module">
  // Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, set, get, child, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
    authDomain: "f1resource-8fedc.firebaseapp.com",
    databaseURL: "https://f1resource-8fedc-default-rtdb.firebaseio.com",
    projectId: "f1resource-8fedc",
    storageBucket: "f1resource-8fedc.firebasestorage.app",
    messagingSenderId: "182745701982",
    appId: "1:182745701982:web:9f4f3836b41b450987decf"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Local login
  const USERS = {
    "ADMIN": { password: "ADMIN", role: "admin" },
    "DEPTADMIN": { password: "DEPTADMIN", role: "departmentAdmin", department: "ExampleDept" },
    "USER": { password: "USER", role: "departmentUser", department: "ExampleDept" }
  };

  window.login = function() {
    const u = document.getElementById("username").value.trim();
    const p = document.getElementById("password").value.trim();
    const loginError = document.getElementById("loginError");
    if(USERS[u] && USERS[u].password === p){
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("app").style.display = "flex";
      window.currentUser = USERS[u];
      showPage("home");
      loadAllData();
    } else {
      loginError.textContent = "Invalid username or password.";
    }
  }

  window.showPage = function(pageId){
    document.querySelectorAll(".page").forEach(p => p.style.display = "none");
    document.getElementById(pageId).style.display = "block";
  }

  // CRUD Functions
  async function loadAllData(){
    loadDepartments();
    loadEMS();
    loadResources();
    loadCoordinators();
  }

  function loadDepartments(){
    const deptList = document.getElementById("departmentList");
    deptList.innerHTML = "";
    const refDept = ref(db, 'departments');
    onValue(refDept, (snapshot) => {
      deptList.innerHTML = "";
      snapshot.forEach((childSnap) => {
        const dep = childSnap.val();
        const key = childSnap.key;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <strong>${dep.name}</strong><br/>
          Address: ${dep.address || ""}<br/>
          Battalion: ${dep.battalion || ""}<br/>
          Apparatus: ${dep.apparatus || ""}<br/>
          Status: ${dep.status || ""}
          ${currentUser.role === "admin" || (currentUser.role === "departmentAdmin" && currentUser.department === dep.name)
            ? `<button onclick="editDepartment('${key}')">Edit</button>
               <button onclick="deleteDepartment('${key}')">Delete</button>` : ""}
        `;
        deptList.appendChild(card);
      });
    });
  }

  window.addDepartment = function(){
    if(!currentUser || (currentUser.role !== "admin" && currentUser.role !== "departmentAdmin")) return alert("No permission");
    const name = prompt("Department Name:");
    if(!name) return;
    const address = prompt("Address:");
    const battalion = prompt("Battalion:");
    const apparatus = prompt("Apparatus:");
    const status = prompt("Status:");
    push(ref(db, 'departments'), { name, address, battalion, apparatus, status });
  }

  window.editDepartment = function(key){
    const refDept = ref(db, 'departments/' + key);
    get(refDept).then(snapshot => {
      const dep = snapshot.val();
      const name = prompt("Department Name:", dep.name);
      if(!name) return;
      const address = prompt("Address:", dep.address);
      const battalion = prompt("Battalion:", dep.battalion);
      const apparatus = prompt("Apparatus:", dep.apparatus);
      const status = prompt("Status:", dep.status);
      update(refDept, { name, address, battalion, apparatus, status });
    });
  }

  window.deleteDepartment = function(key){
    if(!confirm("Delete this department?")) return;
    remove(ref(db, 'departments/' + key));
  }

  // Similar CRUD for EMS
  function loadEMS(){
    const emsList = document.getElementById("emsList");
    emsList.innerHTML = "";
    const refEMS = ref(db, 'ems');
    onValue(refEMS, (snapshot) => {
      emsList.innerHTML = "";
      snapshot.forEach(childSnap => {
        const ems = childSnap.val();
        const key = childSnap.key;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<strong>${ems.name}</strong><br/>
                          ${currentUser.role === "admin" || (currentUser.role === "departmentAdmin" && currentUser.department === ems.department)
                            ? `<button onclick="editEMS('${key}')">Edit</button>
                               <button onclick="deleteEMS('${key}')">Delete</button>` : ""}`;
        emsList.appendChild(card);
      });
    });
  }

  window.addEMS = function(){
    if(!currentUser || (currentUser.role !== "admin" && currentUser.role !== "departmentAdmin")) return alert("No permission");
    const name = prompt("EMS Name:");
    if(!name) return;
    const department = currentUser.role === "departmentAdmin" ? currentUser.department : prompt("Department:");
    push(ref(db, 'ems'), { name, department });
  }

  window.editEMS = function(key){
    const refEMS = ref(db, 'ems/' + key);
    get(refEMS).then(snapshot => {
      const ems = snapshot.val();
      const name = prompt("EMS Name:", ems.name);
      if(!name) return;
      update(refEMS, { name });
    });
  }

  window.deleteEMS = function(key){
    if(!confirm("Delete this EMS?")) return;
    remove(ref(db, 'ems/' + key));
  }

  // Resources
  function loadResources(){
    const resList = document.getElementById("resourceList");
    resList.innerHTML = "";
    const refRes = ref(db, 'resources');
    onValue(refRes, snapshot => {
      resList.innerHTML = "";
      snapshot.forEach(childSnap => {
        const res = childSnap.val();
        const key = childSnap.key;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<strong>${res.name}</strong><br/>
                          ${currentUser.role === "admin" ? `<button onclick="editResource('${key}')">Edit</button>
                          <button onclick="deleteResource('${key}')">Delete</button>` : ""}`;
        resList.appendChild(card);
      });
    });
  }

  window.addResource = function(){
    if(currentUser.role !== "admin") return alert("No permission");
    const name = prompt("Resource Name:");
    if(!name) return;
    push(ref(db, 'resources'), { name });
  }

  window.editResource = function(key){
    const refRes = ref(db, 'resources/' + key);
    get(refRes).then(snapshot => {
      const res = snapshot.val();
      const name = prompt("Resource Name:", res.name);
      if(!name) return;
      update(refRes, { name });
    });
  }

  window.deleteResource = function(key){
    if(!confirm("Delete this resource?")) return;
    remove(ref(db, 'resources/' + key));
  }

  // Coordinators
  function loadCoordinators(){
    const coordList = document.getElementById("coordinatorList");
    coordList.innerHTML = "";
    const refCoord = ref(db, 'coordinators');
    onValue(refCoord, snapshot => {
      coordList.innerHTML = "";
      snapshot.forEach(childSnap => {
        const coord = childSnap.val();
        const key = childSnap.key;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<strong>${coord.name}</strong><br/>
                          ${currentUser.role === "admin" ? `<button onclick="editCoordinator('${key}')">Edit</button>
                          <button onclick="deleteCoordinator('${key}')">Delete</button>` : ""}`;
        coordList.appendChild(card);
      });
    });
  }

  window.addCoordinator = function(){
    if(currentUser.role !== "admin") return alert("No permission");
    const name = prompt("Coordinator Name:");
    if(!name) return;
    push(ref(db, 'coordinators'), { name });
  }

  window.editCoordinator = function(key){
    const refCoord = ref(db, 'coordinators/' + key);
    get(refCoord).then(snapshot => {
      const coord = snapshot.val();
      const name = prompt("Coordinator Name:", coord.name);
      if(!name) return;
      update(refCoord, { name });
    });
  }

  window.deleteCoordinator = function(key){
    if(!confirm("Delete this coordinator?")) return;
    remove(ref(db, 'coordinators/' + key));
  }

</script>

<style>
  body{margin:0;font-family:Arial,sans-serif;background:#f5f5f5}
  #loginBox{width:300px;margin:100px auto;padding:20px;background:white;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.2);}
  #loginBox input{width:100%;margin:5px 0;padding:8px;border-radius:6px;border:1px solid #ccc;}
  #loginBox button{width:100%;padding:10px;background:#007bff;color:white;border:none;border-radius:6px;cursor:pointer;}
  #app{display:none;height:100vh;flex-direction:row}
  #sidebar{width:250px;background:#1a1a1a;color:white;padding:20px;position:fixed;top:0;bottom:0;left:0;overflow-y:auto}
  #sidebar h2{margin-top:0}
  #sidebar button{width:100%;padding:10px;margin:5px 0;border:none;background:#333;color:white;border-radius:6px;text-align:left;cursor:pointer}
  #content{margin-left:270px;padding:20px;flex:1}
  .page{display:none}
  .card{background:white;padding:15px;border-radius:8px;margin:10px 0;box-shadow:0 0 5px rgba(0,0,0,0.1);}
  @media(max-width:768px){
    #sidebar{position:relative;width:100%;height:auto;margin-bottom:10px}
    #content{margin-left:0}
  }
</style>

<body>
  <div id="loginBox">
    <h2>Login</h2>
    <input id="username" placeholder="Username"/>
    <input id="password" type="password" placeholder="Password"/>
    <button onclick="login()">Login</button>
    <p id="loginError" style="color:red"></p>
  </div>

  <div id="app">
    <div id="sidebar">
      <h2>F1 Resource</h2>
      <button onclick="showPage('home')">Home</button>
      <button onclick="showPage('departments')">Fire Departments</button>
      <button onclick="showPage('ems')">EMS Agencies</button>
      <button onclick="showPage('resources')">County Resources</button>
      <button onclick="showPage('coordinators')">County Coordinators</button>
      <button onclick="showPage('hazmat')">HazMat</button>
      <button onclick="showPage('ev')">EV Safety</button>
      <button onclick="showPage('firerisk')">Fire Risk</button>
      <button onclick="showPage('drivingsafety')">Driving Safety</button>
    </div>

    <div id="content">
      <div id="home" class="page" style="display:block">
        <h1>WELCOME</h1>
        <p>F1 Resource: All-inclusive application for Oswego County emergency services.</p>
      </div>

      <div id="departments" class="page">
        <h2>Fire Departments</h2>
        <button onclick="addDepartment()">Add Department</button>
        <div id="departmentList"></div>
      </div>

      <div id="ems" class="page">
        <h2>EMS Agencies</h2>
        <button onclick="addEMS()">Add EMS Agency</button>
        <div id="emsList"></div>
      </div>

      <div id="resources" class="page">
        <h2>County Resources</h2>
        <button onclick="addResource()">Add Resource</button>
        <div id="resourceList"></div>
      </div>

      <div id="coordinators" class="page">
        <h2>County Coordinators</h2>
        <button onclick="addCoordinator()">Add Coordinator</button>
        <div id="coordinatorList"></div>
      </div>

      <div id="hazmat" class="page">
        <h2>HazMat</h2>
        <input id="hazmatInput" placeholder="UN Number"/>
        <button onclick="alert('Replace with ERG lookup')">Search</button>
        <div id="hazmatResult"></div>
      </div>

      <div id="ev" class="page">
        <h2>EV Safety</h2>
        <input id="evYM" placeholder="Year Make Model"/>
        <button onclick="alert('Replace with NHTSA EV guide')">Search</button>
        <div id="evResult"></div>
      </div>

      <div id="firerisk" class="page"><h2>Fire Risk</h2></div>
      <div id="drivingsafety" class="page"><h2>Driving Safety</h2></div>

    </div>
  </div>
</body>
</html>

