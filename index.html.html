<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F1 Resource</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#f5f5f5; }
  #loginBox { width:300px; margin:120px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2); }
  #app { display:none; height:100vh; }
  #sidebar { width:250px; background:#1a1a1a; color:white; padding:20px; position:fixed; top:0; bottom:0; left:0; overflow-y:auto; }
  #sidebar h2 { margin-top:0; }
  #sidebar button { width:100%; padding:10px; margin:5px 0; border:none; background:#333; color:white; border-radius:6px; text-align:left; }
  #sidebar button:hover { background:#444; cursor:pointer; }
  #content { margin-left:270px; padding:20px; }
  .hidden { display:none; }
  .card { background:white; padding:15px; border-radius:8px; margin:10px 0; box-shadow:0 0 5px rgba(0,0,0,0.1); }
  input, select { width:100%; padding:8px; margin:5px 0; border-radius:6px; border:1px solid #ccc; }
  .top-alerts { background:#ffdddd; padding:10px; text-align:center; font-weight:bold; }
  @media(max-width:768px){
    #sidebar { width:70px; padding:10px; }
    #content { margin-left:90px; padding:10px; }
    #sidebar button { font-size:12px; padding:5px; }
  }
</style>
</head>
<body>

<div id="loginBox">
  <h2>Login</h2>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p id="loginError" style="color:red;"></p>
</div>

<div id="app">
  <div class="top-alerts" id="activeAlerts">Loading active weather alerts...</div>
  <div id="sidebar">
    <h2>F1 Resource</h2>
    <button onclick="showPage('home')">Home</button>
    <button onclick="showPage('departments')">Fire Departments</button>
    <button onclick="showPage('ems')">EMS Agencies</button>
    <button onclick="showPage('resources')">County Resources</button>
    <button onclick="showPage('coordinators')">County Coordinators</button>
    <button onclick="showPage('hazmat')">HazMat</button>
    <button onclick="showPage('ev')">EV Safety</button>
    <button onclick="showPage('firerisk')">Fire Risk</button>
    <button onclick="showPage('drivingsafety')">Driving Safety</button>
  </div>

  <div id="content">
    <div id="home" class="page"><h1>WELCOME</h1><p>This is F1 Resource, your all inclusive application for Oswego County resources.</p></div>

    <div id="departments" class="page hidden">
      <h2>Fire Departments</h2>
      <button onclick="addDepartment()">Add Department</button>
      <div id="departmentList"></div>
    </div>

    <div id="ems" class="page hidden">
      <h2>EMS Agencies</h2>
      <button onclick="addEMS()">Add EMS Agency</button>
      <div id="emsList"></div>
    </div>

    <div id="resources" class="page hidden">
      <h2>County Resources</h2>
      <button onclick="addResource()">Add Resource</button>
      <div id="resourceList"></div>
    </div>

    <div id="coordinators" class="page hidden">
      <h2>County Coordinators</h2>
      <button onclick="addCoordinator()">Add Coordinator</button>
      <div id="coordinatorList"></div>
    </div>

    <div id="hazmat" class="page hidden">
      <h2>HazMat</h2>
      <input id="hazmatInput" placeholder="Enter UN Number">
      <button onclick="searchHazMat()">Search</button>
      <div id="hazmatResult"></div>
    </div>

    <div id="ev" class="page hidden">
      <h2>EV Safety</h2>
      <input id="evYM" placeholder="Year Make Model">
      <button onclick="searchEV()">Search</button>
      <div id="evResult"></div>
    </div>

    <div id="firerisk" class="page hidden"><h2>Fire Risk</h2></div>
    <div id="drivingsafety" class="page hidden"><h2>Driving Safety</h2></div>
  </div>
</div>

<script type="module">
  // Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
    authDomain: "f1resource-8fedc.firebaseapp.com",
    projectId: "f1resource-8fedc",
    storageBucket: "f1resource-8fedc.firebasestorage.app",
    messagingSenderId: "182745701982",
    appId: "1:182745701982:web:9f4f3836b41b450987decf"
  };

  const appFirebase = initializeApp(firebaseConfig);
  const db = getFirestore(appFirebase);

  // Login roles
  let currentUser = null;

  async function login(){
    const u = username.value.trim();
    const p = password.value.trim();

    const usersCol = collection(db, "users");
    const q = query(usersCol, where("username","==",u), where("password","==",p));
    const userSnap = await getDocs(q);

    if(!userSnap.empty){
      currentUser = userSnap.docs[0].data();
      loginBox.style.display = "none";
      app.style.display = "flex";
      loadAllData();
      showPage('home');
    } else {
      loginError.textContent = "Invalid login";
    }
  }

  function showPage(id){
    document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  }

  // --- Real-time Firestore sync ---
  async function loadAllData(){
    loadDepartments();
    loadEMS();
    loadResources();
    loadCoordinators();
    loadActiveAlerts();
  }

  async function loadDepartments(){
    const deptList = document.getElementById('departmentList');
    deptList.innerHTML = "";
    const q = collection(db, "departments");
    onSnapshot(q, (snap)=>{
      deptList.innerHTML = "";
      snap.forEach(doc => {
        const d = doc.data();
        const card = document.createElement('div');
        card.className="card";
        card.innerHTML=`<b>${d.name}</b> - ${d.battalion}<br>${d.address}`;
        if(currentUser.role === "admin" || (currentUser.role==="deptadmin" && currentUser.department===d.name)){
          card.innerHTML += `<br><button onclick="editDepartment('${doc.id}')">Edit</button>`;
        }
        deptList.appendChild(card);
      });
    });
  }

  async function loadEMS(){
    const list = document.getElementById('emsList'); list.innerHTML="";
    const q = collection(db,"ems");
    onSnapshot(q,(snap)=>{
      list.innerHTML="";
      snap.forEach(doc=>{
        const d=doc.data();
        const card=document.createElement('div');
        card.className="card";
        card.innerHTML=`<b>${d.name}</b><br>${d.address}`;
        if(currentUser.role==="admin") card.innerHTML+=`<br><button onclick="editEMS('${doc.id}')">Edit</button>`;
        list.appendChild(card);
      });
    });
  }

  async function loadResources(){
    const list = document.getElementById('resourceList'); list.innerHTML="";
    const q = collection(db,"resources");
    onSnapshot(q,(snap)=>{
      list.innerHTML="";
      snap.forEach(doc=>{
        const d=doc.data();
        const card=document.createElement('div');
        card.className="card";
        card.innerHTML=`<b>${d.name}</b><br>${d.details}`;
        if(currentUser.role==="admin") card.innerHTML+=`<br><button onclick="editResource('${doc.id}')">Edit</button>`;
        list.appendChild(card);
      });
    });
  }

  async function loadCoordinators(){
    const list=document.getElementById('coordinatorList'); list.innerHTML="";
    const q=collection(db,"coordinators");
    onSnapshot(q,(snap)=>{
      list.innerHTML="";
      snap.forEach(doc=>{
        const d=doc.data();
        const card=document.createElement('div');
        card.className="card";
        card.innerHTML=`<b>${d.name}</b><br>${d.contact}`;
        if(currentUser.role==="admin") card.innerHTML+=`<br><button onclick="editCoordinator('${doc.id}')">Edit</button>`;
        list.appendChild(card);
      });
    });
  }

  async function loadActiveAlerts(){
    const alertsEl = document.getElementById('activeAlerts');
    // Dummy alerts - replace with actual API integration
    alertsEl.textContent = "No active weather alerts in Oswego County.";
  }

  // --- Add/Edit functions ---
  async function addDepartment(){
    const name=prompt("Department Name");
    const battalion=prompt("Battalion");
    const address=prompt("Address");
    if(name && battalion && address){
      await addDoc(collection(db,"departments"),{name,battalion,address});
    }
  }

  async function editDepartment(id){
    const dRef=doc(db,"departments",id);
    const name=prompt("New Department Name");
    const battalion=prompt("Battalion");
    const address=prompt("Address");
    if(name && battalion && address){
      await updateDoc(dRef,{name,battalion,address});
    }
  }

  async function addEMS(){ const name=prompt("EMS Name"); const address=prompt("Address"); if(name){await addDoc(collection(db,"ems"),{name,address});}}
  async function editEMS(id){ const dRef=doc(db,"ems",id); const name=prompt("New Name"); const address=prompt("Address"); if(name){await updateDoc(dRef,{name,address});}}

  async function addResource(){ const name=prompt("Resource Name"); const details=prompt("Details"); if(name){await addDoc(collection(db,"resources"),{name,details});}}
  async function editResource(id){ const dRef=doc(db,"resources",id); const name=prompt("New Name"); const details=prompt("Details"); if(name){await updateDoc(dRef,{name,details});}}

  async function addCoordinator(){ const name=prompt("Coordinator Name"); const contact=prompt("Contact Info"); if(name){await addDoc(collection(db,"coordinators"),{name,contact});}}
  async function editCoordinator(id){ const dRef=doc(db,"coordinators",id); const name=prompt("New Name"); const contact=prompt("Contact Info"); if(name){await updateDoc(dRef,{name,contact});}}

  function searchHazMat(){
    const un = hazmatInput.value.trim();
    hazmatResult.innerHTML = `<p>ERGuide 2024 lookup for UN ${un} will appear here.</p>`;
  }

  function searchEV(){
    const ym = evYM.value.trim();
    evResult.innerHTML = `<p>NHTSA EV Emergency Guide info for ${ym} will appear here.</p>`;
  }

</script>

</body>
</html>


