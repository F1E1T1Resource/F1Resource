<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>F1 Resource</title>
<style>
  :root{--primary:#002b5c;--accent:#0b5fff;--muted:#6b7280;--card:#ffffff}
  body{margin:0;font-family:Inter,sans-serif;background:#eef2f5;color:#0f1724}
  #loginScreen,#app{display:none}
  .centerBox{max-width:460px;margin:64px auto;padding:26px;background:var(--card);border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.08);}
  input,select,textarea{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid #d1d5db;font-size:15px;}
  button{padding:10px 14px;background:var(--primary);border:none;color:white;font-size:15px;border-radius:8px;cursor:pointer;}
  button.ghost{background:transparent;color:var(--primary);border:1px solid #d1d5db}
  button.small{padding:6px 10px;font-size:13px}
  #layout{display:flex;height:100vh;}
  #sidebar{width:260px;background:var(--primary);color:white;padding:18px;transition:.25s;overflow-y:auto;}
  #sidebar.hidden{width:0;padding:0;overflow:hidden;}
  #sidebar h2{margin:0 0 12px;font-size:18px}
  #sidebar a{display:block;color:white;padding:10px 0;cursor:pointer;font-size:15px;text-decoration:none}
  #sidebar a:hover{text-decoration:underline}
  #content{flex:1;padding:20px;overflow-y:auto;}
  #toggleMenu{position:fixed;top:12px;left:12px;background:var(--primary);color:white;border:none;padding:10px;border-radius:8px;font-size:18px;z-index:50}
  .sectionCard{background:var(--card);padding:18px;border-radius:10px;margin-bottom:18px;box-shadow:0 6px 20px rgba(2,6,23,0.06);}
  .listItem{padding:10px;border-radius:8px;border:1px solid #eef2ff;margin-top:8px;background:#fff;display:flex;justify-content:space-between;align-items:center}
  .muted{color:var(--muted);font-size:13px}
  @media(max-width:900px){#layout{flex-direction:column}#sidebar{width:100%;position:fixed;left:0;top:0;transform:translateY(-150%)}#sidebar.show{transform:translateY(0)}#toggleMenu{position:fixed;left:8px;top:8px}}
</style>
<script type="module">
  // --- Firebase SDK ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
    authDomain: "f1resource-8fedc.firebaseapp.com",
    databaseURL: "https://f1resource-8fedc-default-rtdb.firebaseio.com",
    projectId: "f1resource-8fedc",
    storageBucket: "f1resource-8fedc.firebasestorage.app",
    messagingSenderId: "182745701982",
    appId: "1:182745701982:web:9f4f3836b41b450987decf"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // --- Local Login ---
  let currentUser = null;
  const users = {
    dlyboult:{password:"F1Resource",role:"ADMIN"}
  };

  function login(){
    const u = document.getElementById("username").value.trim();
    const p = document.getElementById("password").value.trim();
    if(users[u] && users[u].password===p){
      currentUser={username:u,role:users[u].role};
      document.getElementById("loginScreen").style.display="none";
      document.getElementById("app").style.display="block";
      if(currentUser.role==="ADMIN") document.getElementById("adminControls").style.display="block";
      showPage("home");
      loadAllData();
    } else alert("Invalid credentials");
  }

  function toggleSidebar(){const sb=document.getElementById("sidebar");if(window.innerWidth<=900){sb.classList.toggle("show");}else{sb.classList.toggle("hidden");}}
  function showPage(id){document.querySelectorAll(".page").forEach(p=>p.style.display="none");const el=document.getElementById(id);if(el)el.style.display="block";}

  // --- Data Load ---
  let store = {
    resources:{},coordinators:{},fireAgencies:{},emsAgencies:{},hazmat:{},evs:{}
  };

  function loadAllData(){
    const rootRef = ref(db,'f1resource');
    onValue(rootRef,(snapshot)=>{
      store=snapshot.val()||store;
      renderAll();
    });
  }

  function saveStore(){ set(ref(db,'f1resource'),store); }

  // --- Render Functions ---
  function renderAll(){ renderResources(); renderCoordinators(); renderFire(); renderEMS(); renderHazMat(); renderEVs(); }
  
  function renderResources(){
    const target=document.getElementById("resourceList"); target.innerHTML="";
    Object.values(store.resources||{}).forEach(r=>{
      const div=document.createElement("div"); div.className="listItem";
      div.innerHTML=`<div><strong>${r.name}</strong><div class='muted'>${r.capabilities||""}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="editResource('${r.id}')">Edit</button><button class='small' onclick="deleteResource('${r.id}')">Delete</button></div>`;
      target.appendChild(div);
    });
  }

  function renderCoordinators(){
    const target=document.getElementById("coordinatorList"); target.innerHTML="";
    Object.values(store.coordinators||{}).forEach(c=>{
      const div=document.createElement("div"); div.className="listItem";
      div.innerHTML=`<div><strong>${c.name}</strong><div class='muted'>Callsign: ${c.callsign||""}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="editCoordinator('${c.id}')">Edit</button><button class='small' onclick="deleteCoordinator('${c.id}')">Delete</button></div>`;
      target.appendChild(div);
    });
  }

  function renderFire(){
    const target=document.getElementById("fireList"); target.innerHTML="";
    Object.values(store.fireAgencies||{}).forEach(a=>{
      const div=document.createElement("div"); div.className="listItem";
      div.innerHTML=`<div><strong>${a.name}</strong><div class='muted'>Battalion: ${a.battalion||"-"} • Stations: ${(a.stations||[]).join("; ")}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="editFire('${a.id}')">Edit</button><button class='small' onclick="deleteFire('${a.id}')">Delete</button></div>`;
      target.appendChild(div);
    });
  }

  function renderEMS(){
    const target=document.getElementById("emsList"); target.innerHTML="";
    Object.values(store.emsAgencies||{}).forEach(a=>{
      const div=document.createElement("div"); div.className="listItem";
      div.innerHTML=`<div><strong>${a.name}</strong><div class='muted'>Stations: ${(a.stations||[]).join("; ")}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="editEms('${a.id}')">Edit</button><button class='small' onclick="deleteEms('${a.id}')">Delete</button></div>`;
      target.appendChild(div);
    });
  }

  function renderHazMat(){
    const target=document.getElementById("hazmatList"); target.innerHTML="";
    Object.values(store.hazmat||{}).forEach(h=>{
      const div=document.createElement("div"); div.className="listItem";
      div.innerHTML=`<div><strong>${h.name}</strong><div class='muted'>UN: ${h.un} • ${h.hazard_class}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="editHazMat('${h.un}')">Edit</button><button class='small' onclick="deleteHazMat('${h.un}')">Delete</button></div>`;
      target.appendChild(div);
    });
  }

  function renderEVs(){
    const target=document.getElementById("evList"); target.innerHTML="";
    Object.values(store.evs||{}).forEach(ev=>{
      const div=document.createElement("div"); div.className="listItem";
      div.innerHTML=`<div><strong>${ev.make} ${ev.model} (${ev.year})</strong><div class='muted'>Battery: ${ev.battery_type} • Disconnect: ${ev.disconnect}</div></div>
      <div style="display:flex;gap:8px"><button class='small' onclick="editEV('${ev.id}')">Edit</button><button class='small' onclick="deleteEV('${ev.id}')">Delete</button></div>`;
      target.appendChild(div);
    });
  }

  // --- CRUD Helpers ---
  function uid(){return 'id_'+Math.random().toString(36).slice(2,9);}
  function isAdmin(){return currentUser&&currentUser.role==="ADMIN";}

  // Example CRUD for Fire Agencies (similar for others)
  function addFire(){
    if(!isAdmin()){alert("Admin only");return;}
    const name=prompt("Agency name"); if(!name)return;
    const batt=prompt("Battalion (optional)");
    const stations=prompt("Stations (pipe separated)","Station 1|Station 2");
    const id=uid();
    store.fireAgencies[ id ]={id,name,battalion:batt,stations:stations.split("|").map(s=>s.trim())};
    saveStore(); renderFire();
  }
  function editFire(id){
    if(!isAdmin()){alert("Admin only");return;}
    const a=store.fireAgencies[id]; if(!a)return;
    a.name=prompt("Agency name",a.name)||a.name;
    a.battalion=prompt("Battalion",a.battalion)||a.battalion;
    const stations=prompt("Stations (pipe separated)",(a.stations||[]).join("|"));
    a.stations=stations.split("|").map(s=>s.trim());
    saveStore(); renderFire();
  }
  function deleteFire(id){
    if(!isAdmin()){alert("Admin only");return;}
    if(confirm("Delete agency?")){delete store.fireAgencies[id];saveStore();renderFire();}
  }

  // --- Page Initialization ---
  document.addEventListener("DOMContentLoaded",()=>{document.getElementById("loginScreen").style.display="block";});
</script>
</head>
<body>
<div id="loginScreen" class="centerBox">
  <h2>F1 Resource Login</h2>
  <div class="muted">Authorized Fire Department Members Only</div>
  <input id="username" placeholder="Username" />
  <input id="password" placeholder="Password" type="password"/>
  <div style="display:flex;gap:8px;margin-top:10px">
    <button onclick="login()">Login</button>
  </div>
</div>

<div id="app">
  <button id="toggleMenu" onclick="toggleSidebar()">☰</button>
  <div id="layout">
    <aside id="sidebar">
      <h2>F1 Resource</h2>
      <nav>
        <a onclick="showPage('home')">Home</a>
        <a onclick="showPage('countyResources')">County Resources</a>
        <a onclick="showPage('countyCoordinators')">County Coordinators</a>
        <a onclick="showPage('fireAgencies')">Fire Agencies</a>
        <a onclick="showPage('emsAgencies')">EMS Agencies</a>
        <a onclick="showPage('hazmat')">HazMat</a>
        <a onclick="showPage('evSafety')">EV Safety</a>
      </nav>
      <hr/>
      <div id="adminControls" style="display:none">
        <div>Admin Controls</div>
        <!-- Admin specific links can go here -->
      </div>
    </aside>
    <main id="content">
      <section id="home" class="page">
        <div class="sectionCard">
          <h1>WELCOME</h1>
          <div class="muted">This is <strong>F1 Resource</strong>, your all-inclusive application for Oswego County resources.</div>
        </div>
      </section>
      <section id="countyResources" class="page" style="display:none">
        <div class="sectionCard">
          <h2>County Resources</h2>
          <div id="resourceList"></div>
        </div>
      </section>
      <section id="countyCoordinators" class="page" style="display:none">
        <div class="sectionCard">
          <h2>County Coordinators</h2>
          <div id="coordinatorList"></div>
        </div>
      </section>
      <section id="fireAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <h2>Fire Agencies</h2>
          <div id="fireList"></div>
        </div>
      </section>
      <section id="emsAgencies" class="page" style="display:none">
        <div class="sectionCard">
          <h2>EMS Agencies</h2>
          <div id="emsList"></div>
        </div>
      </section>
      <section id="hazmat" class="page" style="display:none">
        <div class="sectionCard">
          <h2>HazMat</h2>
          <div id="hazmatList"></div>
        </div>
      </section>
      <section id="evSafety" class="page" style="display:none">
        <div class="sectionCard">
          <h2>EV Safety</h2>
          <div id="evList"></div>
        </div>
      </section>
    </main>
  </div>
</div>
</body>
</html>
