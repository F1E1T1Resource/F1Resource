<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F1 Resource</title>
<style>
  body { margin:0; font-family:Arial, sans-serif; background:#f5f5f5; }
  #loginBox {
    width: 320px;
    max-width: 90%;
    margin: 120px auto;
    padding: 25px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    text-align:center;
  }
  #loginBox h2 { margin-bottom: 20px; }
  #loginBox input { width:90%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc; }
  #loginBox button { width:95%; padding:10px; border:none; background:#007bff; color:white; border-radius:6px; cursor:pointer; }
  #loginError { color:red; margin-top:10px; }

  #app { display:none; }
  #sidebar {
    width:250px;
    background:#1a1a1a;
    color:white;
    padding:20px;
    position:fixed;
    top:0;
    bottom:0;
    left:0;
    overflow-y:auto;
  }
  #sidebar h2 { margin-top:0; text-align:center; }
  #sidebar button {
    width:100%;
    padding:10px;
    margin:5px 0;
    border:none;
    background:#333;
    color:white;
    border-radius:6px;
    cursor:pointer;
    text-align:left;
  }
  #sidebar button:hover { background:#444; }
  #content { margin-left:270px; padding:20px; }
  .hidden { display:none; }
  .card { background:white; padding:15px; border-radius:8px; margin:10px 0; box-shadow:0 0 5px rgba(0,0,0,0.1); }
  input, select { width:100%; padding:8px; margin:5px 0; border-radius:6px; border:1px solid #ccc; }
  @media(max-width:768px){
    #sidebar { width:60px; padding:10px; }
    #content { margin-left:70px; }
    #sidebar button { font-size:12px; padding:8px; }
  }
</style>
</head>
<body>

<div id="loginBox">
  <h2>F1 Resource Login</h2>
  <input id="username" placeholder="Username" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="login()">Login</button>
  <p id="loginError"></p>
</div>

<div id="app">
  <div id="sidebar">
    <h2>F1 Resource</h2>
    <button onclick="showPage('home')">Home</button>
    <button onclick="showPage('departments')">Fire Departments</button>
    <button onclick="showPage('ems')">EMS Agencies</button>
    <button onclick="showPage('resources')">County Resources</button>
    <button onclick="showPage('coordinators')">County Coordinators</button>
    <button onclick="showPage('hazmat')">HazMat Search</button>
    <button onclick="showPage('ev')">EV Safety</button>
    <button onclick="showPage('firerisk')">Fire Risk</button>
    <button onclick="showPage('driving')">Driving Safety</button>
  </div>

  <div id="content">
    <div id="home" class="page">
      <h1>Welcome</h1>
      <p>F1 Resource: your all-inclusive tool for Oswego County resources</p>
      <div id="weatherWidget" class="card">
        <h3>Active Weather Alerts</h3>
        <p>Weather alerts will appear here.</p>
      </div>
    </div>

    <div id="departments" class="page hidden">
      <h2>Fire Departments</h2>
      <button onclick="addDepartment()">Add Department</button>
      <div id="departmentList"></div>
    </div>

    <div id="ems" class="page hidden">
      <h2>EMS Agencies</h2>
      <button onclick="addEMS()">Add EMS Agency</button>
      <div id="emsList"></div>
    </div>

    <div id="resources" class="page hidden">
      <h2>County Resources</h2>
      <button onclick="addResource()">Add Resource</button>
      <div id="resourceList"></div>
    </div>

    <div id="coordinators" class="page hidden">
      <h2>County Coordinators</h2>
      <button onclick="addCoordinator()">Add Coordinator</button>
      <div id="coordinatorList"></div>
    </div>

    <div id="hazmat" class="page hidden">
      <h2>HazMat Search</h2>
      <input id="hazmatInput" placeholder="Enter UN Number" />
      <button onclick="searchHazMat()">Search</button>
      <div id="hazmatResult"></div>
    </div>

    <div id="ev" class="page hidden">
      <h2>EV Safety</h2>
      <input id="evYM" placeholder="Year Make Model" />
      <button onclick="searchEV()">Search</button>
      <div id="evResult"></div>
    </div>

    <div id="firerisk" class="page hidden">
      <h2>Fire Risk</h2>
      <p>Add content here</p>
    </div>

    <div id="driving" class="page hidden">
      <h2>Driving Safety</h2>
      <p>Add content here</p>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
  authDomain: "f1resource-8fedc.firebaseapp.com",
  databaseURL: "https://f1resource-8fedc-default-rtdb.firebaseio.com",
  projectId: "f1resource-8fedc",
  storageBucket: "f1resource-8fedc.firebasestorage.app",
  messagingSenderId: "182745701982",
  appId: "1:182745701982:web:9f4f3836b41b450987decf"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ----- INTERNAL LOGIN -----
const USERS = {
  "ADMIN": { password:"ADMIN", role:"admin" },
  "DEPTADMIN": { password:"DEPT123", role:"deptAdmin", dept:"ExampleDept" },
  "DEPTUSER": { password:"USER123", role:"deptUser", dept:"ExampleDept" }
};

let currentUser = null;

function login() {
  const u = username.value.trim();
  const p = password.value.trim();
  if (USERS[u] && USERS[u].password === p) {
    currentUser = USERS[u];
    loginBox.style.display = "none";
    app.style.display = "flex";
    showPage('home');
    loadAllData();
  } else {
    loginError.textContent = "Invalid login";
  }
}

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// ----- DATA FUNCTIONS -----
async function loadAllData() {
  loadCollection('departments', departmentList);
  loadCollection('ems', emsList);
  loadCollection('resources', resourceList);
  loadCollection('coordinators', coordinatorList);
}

async function loadCollection(colName, container) {
  container.innerHTML = "";
  const colRef = collection(db, colName);
  onSnapshot(colRef, snapshot => {
    container.innerHTML = "";
    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<strong>${data.name || 'Unnamed'}</strong>`;
      if (currentUser.role === 'admin' || currentUser.role === 'deptAdmin') {
        card.innerHTML += `<button onclick="editDoc('${colName}','${docSnap.id}')">Edit</button>`;
      }
      container.appendChild(card);
    });
  });
}

// ----- PLACEHOLDER ADD/EDIT FUNCTIONS -----
function addDepartment() { addDoc(collection(db, 'departments'), { name:"New Dept" }); }
function addEMS() { addDoc(collection(db, 'ems'), { name:"New EMS" }); }
function addResource() { addDoc(collection(db, 'resources'), { name:"New Resource" }); }
function addCoordinator() { addDoc(collection(db, 'coordinators'), { name:"New Coordinator" }); }

function editDoc(col, id) { alert(`Edit ${col} ${id}`); }

// ----- SEARCH PLACEHOLDERS -----
function searchHazMat() { hazmatResult.innerHTML = "<p>HazMat info for UN "+hazmatInput.value+"</p>"; }
function searchEV() { evResult.innerHTML = "<p>EV info for "+evYM.value+"</p>"; }

</script>
</body>
</html>
