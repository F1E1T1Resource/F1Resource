<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>F1 Resource — Main App</title>
  <style>
    /* Design A - dark left sidebar */
    :root{
      --bg:#031026; --panel:#081727; --card:#0f1b2b;
      --accent:#0b5fff; --accent2:#7b5cff; --muted:#9aa6bd;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#021023,var(--bg));color:#e6eef9}
    .app{display:flex;min-height:100vh}
    .sidebar{width:240px;padding:18px;background:linear-gradient(180deg,var(--panel),#071323);flex-shrink:0;display:flex;flex-direction:column;gap:12px;border-right:1px solid rgba(255,255,255,0.03)}
    .logo{display:flex;gap:12px;align-items:center}
    .logo img{height:56px;border-radius:8px}
    .brand{font-weight:800}
    .nav{display:flex;flex-direction:column;gap:6px;margin-top:12px}
    .nav button{background:transparent;border:none;color:var(--muted);text-align:left;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .nav button:hover,.nav button.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001020;transform:translateX(6px)}
    .main{flex:1;padding:20px;display:flex;flex-direction:column;gap:16px}
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .card{background:linear-gradient(180deg,#0b1624,#08121a);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .view{display:none}
    .view.active{display:block}
    .list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .listItem{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border:1px solid rgba(255,255,255,0.02)}
    .meta{color:var(--muted);font-size:13px}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001020}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    input,textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#e6eef9;margin:6px 0}
    .muted-block{color:var(--muted);font-size:13px}
    .modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999;background:rgba(0,0,0,0.6)}
    .modal-backdrop.show{display:flex}
    .modal{background:linear-gradient(180deg,#0b1624,#08121a);padding:18px;border-radius:12px;max-width:720px;width:96%;border:1px solid rgba(255,255,255,0.03)}
    @media (max-width:900px){
      .sidebar{display:none}
      .mobileHeader{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:linear-gradient(180deg,#041028,#051428);border-bottom:1px solid rgba(255,255,255,0.03)}
      .drawer{position:fixed;left:0;top:0;height:100%;width:260px;background:linear-gradient(180deg,var(--panel),#071323);box-shadow:8px 0 30px rgba(0,0,0,0.6);transform:translateX(-120%);transition:transform .22s;z-index:1000;padding:20px}
      .drawer.open{transform:translateX(0)}
    }
  </style>
</head>
<body>
  <!-- LOGIN SCREEN -->
  <div id="loginScreen" style="min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;">
    <div class="card" style="max-width:880px;width:100%;display:flex;gap:18px;align-items:center">
      <div style="flex:0 0 88px"><img src="https://c6ee69d755.cbaul-cdnwnd.com/af0c9920a8129f9bf9a0921ecfe9d264/200000017-17b1717b1a/700/F1Resource-removebg-preview.webp?ph=c6ee69d755" alt="logo" style="height:80px;border-radius:10px"></div>
      <div style="flex:1">
        <h2 style="margin:0 0 6px">F1 Resource — Login</h2>
        <div class="muted-block">Local login. App data stored in Firestore. Use ADMIN / ADMIN to sign in.</div>
        <div style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="loginUser" placeholder="Username" />
          <input id="loginPass" placeholder="Password" type="password" />
        </div>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="btnLogin" class="btn primary">Login</button>
          <button id="btnFill" class="btn ghost">Demo Fill</button>
          <button id="btnMobileApp" class="btn ghost" style="margin-left:auto">Mobile Apparatus</button>
        </div>
        <div id="loginMsg" style="color:#ff9b9b;margin-top:8px"></div>
        <div style="margin-top:12px;color:var(--muted)">Initial admin: <strong>ADMIN / ADMIN</strong>. Admin can add data from Admin area.</div>
      </div>
    </div>
  </div>

  <!-- SPA -->
  <div id="spa" class="app" style="display:none">
    <aside class="sidebar" role="navigation" aria-label="Main navigation">
      <div class="logo">
        <img src="https://c6ee69d755.cbaul-cdnwnd.com/af0c9920a8129f9bf9a0921ecfe9d264/200000017-17b1717b1a/700/F1Resource-removebg-preview.webp?ph=c6ee69d755" alt="logo"/>
        <div><div class="brand">F1 Resource</div><div class="muted-block">Oswego County</div></div>
      </div>

      <nav class="nav" aria-label="Pages">
        <button data-view="home" class="active">Home</button>
        <button data-view="departments">Fire Departments</button>
        <button data-view="ems">EMS Agencies</button>
        <button data-view="coordinators">County Coordinators</button>
        <button data-view="teams">County Teams</button>
        <button data-view="hazmat">HazMat Search</button>
        <button data-view="ev">EV Safety</button>
        <button data-view="risks">Fire & Driving Risk</button>
        <button data-view="weather">Weather</button>
        <button data-view="admin">Admin</button>
        <button id="btnLogout" class="btn ghost" style="margin-top:12px">Logout</button>
      </nav>

      <div style="margin-top:auto;color:var(--muted)">&copy; F1 Resource</div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div style="display:flex;gap:12px;align-items:center">
          <img src="https://c6ee69d755.cbaul-cdnwnd.com/af0c9920a8129f9bf9a0921ecfe9d264/200000017-17b1717b1a/700/F1Resource-removebg-preview.webp?ph=c6ee69d755" style="height:56px;border-radius:8px" />
          <div>
            <div style="font-weight:800">WELCOME</div>
            <div class="muted-block">F1 Resource — your all inclusive application for Oswego County.</div>
          </div>
        </div>
        <div id="userBadge" class="muted-block"></div>
      </div>

      <!-- Views -->
      <section id="home" class="view active card"><h3 style="margin:0">Home</h3><div class="muted-block" style="margin-top:8px">Use the navigation to access modules.</div></section>

      <section id="departments" class="view card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Fire Departments</strong><div class="muted-block">Manage departments</div></div>
          <div><button id="addDept" class="btn primary">+ Add</button></div>
        </div>
        <div id="deptList" class="list"></div>
      </section>

      <section id="ems" class="view card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>EMS Agencies</strong></div>
          <div><button id="addEms" class="btn primary">+ Add</button></div>
        </div>
        <div id="emsList" class="list"></div>
      </section>

      <section id="coordinators" class="view card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>County Coordinators</strong></div>
          <div><button id="addCoord" class="btn primary">+ Add</button></div>
        </div>
        <div id="coordList" class="list"></div>
      </section>

      <section id="teams" class="view card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>County Teams</strong></div>
          <div><button id="addTeam" class="btn primary">+ Add Team</button></div>
        </div>
        <div id="teamList" class="list"></div>
      </section>

      <section id="hazmat" class="view card">
        <h3 style="margin:0 0 8px">HazMat Search</h3>
        <div style="display:flex;gap:8px;">
          <input id="hazQuery" placeholder="UN/NA number (e.g. 1203)" />
          <button id="btnHazSearch" class="btn primary">Search</button>
          <button id="btnHazAdmin" class="btn ghost">Add/Edit</button>
        </div>
        <div id="hazResult" style="margin-top:12px"></div>
      </section>

      <section id="ev" class="view card">
        <h3 style="margin:0 0 8px">EV Safety</h3>
        <div style="display:flex;gap:8px">
          <input id="evQuery" placeholder="Year,Make,Model or VIN" />
          <button id="btnEvSearch" class="btn primary">Find</button>
        </div>
        <div id="evResult" style="margin-top:12px"></div>
      </section>

      <section id="risks" class="view card">
        <h3>Fire & Driving Risk</h3>
        <div id="riskBody" class="muted-block" style="margin-top:8px"></div>
      </section>

      <section id="weather" class="view card">
        <h3>Weather</h3>
        <div class="muted-block" style="margin-top:8px">Active weather alerts for Oswego County</div>
        <pre id="weatherBlock" style="white-space:pre-wrap;margin-top:8px;color:var(--muted)"></pre>
      </section>

      <section id="admin" class="view card">
        <h3>Admin</h3>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="manageData" class="btn primary">Manage Data</button>
          <button id="manageHaz" class="btn ghost">HazMat Import</button>
        </div>
      </section>

    </main>
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop"><div class="modal"><h3 id="modalTitle"></h3><div id="modalBody"></div><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px"><button id="modalCancel" class="btn ghost">Cancel</button><button id="modalSave" class="btn primary">Save</button></div></div></div>

  <!-- SCRIPT -->
  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getFirestore, collection, doc, getDoc, getDocs,
      addDoc, setDoc, deleteDoc,
      onSnapshot, query
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // Firebase config (your config)
    const firebaseConfig = {
      apiKey: "AIzaSyBi0Xyljx7zzXTmyyRMAru11hZ2s5S3tsw",
      authDomain: "f1resource-8fedc.firebaseapp.com",
      projectId: "f1resource-8fedc",
      storageBucket: "f1resource-8fedc.firebasestorage.app",
      messagingSenderId: "182745701982",
      appId: "1:182745701982:web:9f4f3836b41b450987decf"
    };
    const fb = initializeApp(firebaseConfig);
    const db = getFirestore(fb);

    // helpers
    const $ = id => document.getElementById(id);
    const ROOT_COL='f1root', ROOT_DOC='f1resource';
    const subCol = (name) => collection(db, ROOT_COL, ROOT_DOC, name);
    const docRef = (col,id) => doc(db, ROOT_COL, ROOT_DOC, col, id);

    // local login (only ADMIN initially)
    const LOCAL_USERS = { "ADMIN": { password: "ADMIN", role: "ADMIN" } };

    function showLogin(){ $('loginScreen').style.display='flex'; $('spa').style.display='none'; }
    function showSpa(){ $('loginScreen').style.display='none'; $('spa').style.display='flex'; }

    // login handlers
    $('btnFill').addEventListener('click', ()=>{ $('loginUser').value='ADMIN'; $('loginPass').value='ADMIN'; });
    $('btnMobileApp').addEventListener('click', ()=>{ window.location.href = 'dispatch.html'; });

    $('btnLogin').addEventListener('click', ()=>{
      const u = ($('loginUser').value||'').trim().toUpperCase();
      const p = ($('loginPass').value||'').trim();
      if(!u||!p){ $('loginMsg').textContent = 'Enter username & password'; return; }
      const user = LOCAL_USERS[u];
      if(!user || user.password !== p){ $('loginMsg').textContent='Invalid credentials'; return; }
      $('loginMsg').textContent='';
      // boot SPA
      CURRENT_USER = { username:u, role:user.role };
      $('userBadge').textContent = `${u} • ${user.role}`;
      showSpa();
      setupNav();
      startRealtime();
    });

    // logout
    $('btnLogout').addEventListener('click', ()=>{ location.reload(); });

    // nav
    function setupNav(){
      document.querySelectorAll('.nav button[data-view]').forEach(b=>{
        b.addEventListener('click', ()=> setView(b.dataset.view));
      });
      setView('home');
    }
    function setView(id){
      document.querySelectorAll('.view').forEach(v=> v.classList.remove('active'));
      const el = document.getElementById(id); if(el) el.classList.add('active');
      document.querySelectorAll('.nav button[data-view]').forEach(b=> b.classList.toggle('active', b.dataset.view===id));
    }

    // modal helpers
    const modal = $('modalBackdrop'), modalTitle=$('modalTitle'), modalBody=$('modalBody'), modalSave=$('modalSave'), modalCancel=$('modalCancel');
    function showModal(title, buildFn, onSave){
      modalTitle.textContent = title; modalBody.innerHTML=''; buildFn(modalBody);
      modal.classList.add('show'); modal.style.display='flex';
      modalSave.onclick = async ()=>{ await onSave(); modal.style.display='none'; modalBody.innerHTML=''; modalSave.onclick=null; };
      modalCancel.onclick = ()=>{ modal.style.display='none'; modalBody.innerHTML=''; modalSave.onclick=null; };
    }

    // realtime start
    let CURRENT_USER = null;
    function startRealtime(){
      // fire_departments
      onSnapshot(query(subCol('fire_departments')), snap => {
        const out = {}; snap.forEach(d=> out[d.id] = d.data()); renderDepartments(out);
      });
      onSnapshot(query(subCol('ems_agencies')), snap => {
        const out = {}; snap.forEach(d=> out[d.id] = d.data()); renderEMS(out);
      });
      onSnapshot(query(subCol('coordinators')), snap => {
        const out = {}; snap.forEach(d=> out[d.id] = d.data()); renderCoordinators(out);
      });
      onSnapshot(query(subCol('county_teams')), snap => {
        const out = {}; snap.forEach(d=> out[d.id] = d.data()); renderTeams(out);
      });
      // weather
      fetchWeather();
    }

    // renderers
    function renderDepartments(data){
      const t=$('deptList'); t.innerHTML=''; Object.entries(data||{}).forEach(([id,d])=>{
        const div=document.createElement('div'); div.className='listItem';
        div.innerHTML = `<div><div style="font-weight:800">${escapeHTML(d.name||'')}</div><div class="meta">${escapeHTML(d.battalion||'')} ${d.address? ' • '+escapeHTML(d.address):''}</div></div>
          <div style="display:flex;gap:8px"><button class="btn small" data-id="${id}" data-act="view-dept">View</button>${CURRENT_USER.role==='ADMIN'?`<button class="btn small" data-id="${id}" data-act="edit-dept">Edit</button>`:''}</div>`;
        t.appendChild(div);
      });
      t.querySelectorAll('button[data-act="view-dept"]').forEach(b=> b.addEventListener('click', ()=> viewDept(b.dataset.id)));
      t.querySelectorAll('button[data-act="edit-dept"]').forEach(b=> b.addEventListener('click', ()=> editDept(b.dataset.id)));
    }
    function renderEMS(data){
      const t=$('emsList'); t.innerHTML=''; Object.entries(data||{}).forEach(([id,e])=>{
        const div=document.createElement('div'); div.className='listItem';
        div.innerHTML=`<div><div style="font-weight:800">${escapeHTML(e.name||'')}</div><div class="meta">${escapeHTML(e.address||'')}</div></div><div><button class="btn small" data-id="${id}" data-act="view-ems">View</button></div>`;
        t.appendChild(div);
      });
      t.querySelectorAll('button[data-act="view-ems"]').forEach(b=> b.addEventListener('click', ()=> viewEms(b.dataset.id)));
    }
    function renderCoordinators(data){
      const t=$('coordList'); t.innerHTML=''; Object.entries(data||{}).forEach(([id,c])=>{
        const div=document.createElement('div'); div.className='listItem';
        div.innerHTML=`<div><div style="font-weight:800">${escapeHTML(c.name||'')}</div><div class="meta">${escapeHTML(c.callsign||'')}</div></div>`;
        t.appendChild(div);
      });
    }
    function renderTeams(data){
      const t=$('teamList'); t.innerHTML=''; Object.entries(data||{}).forEach(([id,tm])=>{
        const div=document.createElement('div'); div.className='listItem';
        div.innerHTML=`<div><div style="font-weight:800">${escapeHTML(tm.name||'')}</div><div class="meta">${escapeHTML(tm.lead||'')}</div></div>`;
        t.appendChild(div);
      });
    }

    // add/edit actions (Admin only)
    $('addDept').addEventListener('click', ()=> {
      if(CURRENT_USER.role !== 'ADMIN'){ alert('Admin only'); return; }
      showModal('Add Department', (root)=> {
        root.innerHTML = `<input id="md_name" placeholder="Name"/><input id="md_batt" placeholder="Battalion"/><input id="md_addr" placeholder="Address"/><input id="md_apps" placeholder="Apparatus (| separated)"/>`;
      }, async ()=> {
        const name=$('md_name').value.trim()||'Unnamed', batt=$('md_batt').value.trim(), addr=$('md_addr').value.trim(), apps=$('md_apps').value.trim();
        await addDoc(subCol('fire_departments'), { name, battalion: batt, address: addr, apparatus: apps });
      });
    });

    $('addEms').addEventListener('click', ()=> {
      if(CURRENT_USER.role !== 'ADMIN'){ alert('Admin only'); return; }
      showModal('Add EMS', (r)=> r.innerHTML=`<input id="me_name" placeholder="Name"/><input id="me_addr" placeholder="Address"/>`, async ()=> {
        const name=$('me_name').value.trim()||'Unnamed', addr=$('me_addr').value.trim(); await addDoc(subCol('ems_agencies'), { name, address: addr });
      });
    });

    $('addCoord').addEventListener('click', ()=> {
      if(CURRENT_USER.role !== 'ADMIN'){ alert('Admin only'); return; }
      showModal('Add Coordinator', (r)=> r.innerHTML=`<input id="mc_name" placeholder="Name"/><input id="mc_callsign" placeholder="Callsign"/>`, async ()=> {
        const name=$('mc_name').value.trim(); const calls=$('mc_callsign').value.trim(); if(!name) return alert('Name required'); await addDoc(subCol('coordinators'), { name, callsign: calls });
      });
    });

    $('addTeam').addEventListener('click', ()=> {
      if(CURRENT_USER.role !== 'ADMIN'){ alert('Admin only'); return; }
      showModal('Add Team', (r)=> r.innerHTML=`<input id="mt_name" placeholder="Team Name"/><input id="mt_lead" placeholder="Lead"/><input id="mt_caps" placeholder="Capabilities (| separated)"/>`, async ()=> {
        const n=$('mt_name').value.trim()||'Unnamed', lead=$('mt_lead').value.trim(), caps=$('mt_caps').value.trim(); await addDoc(subCol('county_teams'), { name:n, lead, capabilities: caps });
      });
    });

    // view / edit dept
    async function viewDept(id){
      const s = await getDoc(docRef('fire_departments', id));
      if(!s.exists()) return alert('Not found');
      const d = s.data();
      showModal('Department', (root)=> {
        root.innerHTML = `<div><strong>${escapeHTML(d.name||'')}</strong><div class="meta">${escapeHTML(d.address||'')}</div><div style="margin-top:8px"><strong>Apparatus</strong><ul>${(d.apparatus||'').split('|').map(x=>`<li>${escapeHTML(x.trim())}</li>`).join('')}</ul></div></div>`;
      }, async ()=> {});
    }
    async function editDept(id){
      if(CURRENT_USER.role !== 'ADMIN'){ alert('Admin only'); return; }
      const s = await getDoc(docRef('fire_departments', id)); if(!s.exists()) return alert('Not found');
      const d = s.data();
      showModal('Edit Department', (root)=> {
        root.innerHTML = `<input id="ed_name" value="${escapeHTML(d.name||'')}" /><input id="ed_batt" value="${escapeHTML(d.battalion||'')}" /><input id="ed_addr" value="${escapeHTML(d.address||'')}" /><input id="ed_apps" value="${escapeHTML(d.apparatus||'')}" />`;
      }, async ()=> {
        const obj = { name:$('ed_name').value.trim(), battalion:$('ed_batt').value.trim(), address:$('ed_addr').value.trim(), apparatus:$('ed_apps').value.trim() };
        await setDoc(docRef('fire_departments', id), obj);
        alert('Saved');
      });
    }

    // HazMat search + admin
    $('btnHazSearch').addEventListener('click', async ()=> {
      const q = ($('hazQuery').value||'').trim(); if(!q) return alert('Enter UN number');
      const s = await getDoc(docRef('hazmat', q));
      if(s.exists()){
        const e = s.data();
        $('hazResult').innerHTML = `<div style="font-weight:800">${escapeHTML(e.name||'')}</div><div class="meta">Class: ${escapeHTML(e.hazard_class||'')}</div><div style="margin-top:8px"><strong>Flammability:</strong> ${escapeHTML(e.flammability||'—')}</div><div><strong>Water reactivity:</strong> ${escapeHTML(e.water_reactivity||'—')}</div><div style="margin-top:8px"><strong>Evacuation (small):</strong> ${escapeHTML(e.evac_small||e.evacuation_small||'—')}</div><div><strong>Evacuation (large):</strong> ${escapeHTML(e.evac_large||e.evacuation_large||'—')}</div><div style="margin-top:8px">${escapeHTML(e.notes||'')}</div>`;
      } else {
        $('hazResult').innerHTML = `<div class="meta">No record for UN ${escapeHTML(q)}. Admins can add entries.</div>`;
      }
    });

    $('btnHazAdmin').addEventListener('click', ()=> {
      if(CURRENT_USER.role !== 'ADMIN'){ alert('Admin only'); return; }
      showModal('Add/Edit HazMat', (root)=> {
        root.innerHTML = `<input id="hz_un" placeholder="UN number"/><input id="hz_name" placeholder="Common name"/><input id="hz_class" placeholder="Hazard class"/><input id="hz_flame" placeholder="Flammability"/><input id="hz_water" placeholder="Water reactivity"/><input id="hz_agent" placeholder="Extinguishing agent"/><textarea id="hz_notes" placeholder="Notes"></textarea>`;
      }, async ()=> {
        const un = $('hz_un').value.trim(); if(!un) return alert('UN required');
        const obj = { un, name:$('hz_name').value.trim(), hazard_class:$('hz_class').value.trim(), flammability:$('hz_flame').value.trim(), water_reactivity:$('hz_water').value.trim(), extinguishing_agent:$('hz_agent').value.trim(), notes:$('hz_notes').value.trim() };
        await setDoc(docRef('hazmat', un), obj); alert('Saved');
      });
    });

    // EV search (simple)
    $('btnEvSearch').addEventListener('click', async ()=> {
      const v = ($('evQuery').value||'').trim(); if(!v) return alert('Enter YMM or Make');
      const key = v.split(',')[1] ? v.split(',')[1].trim().toLowerCase().replace(/\s+/g,'_') : v.trim().toLowerCase().replace(/\s+/g,'_');
      const s = await getDoc(docRef('ev_guides', key));
      if(s.exists()){
        const d = s.data(); $('evResult').innerHTML = `<div style="font-weight:800">${escapeHTML(d.make||key)}</div><div style="margin-top:6px"><a href="${escapeHTML(d.url)}" target="_blank">${escapeHTML(d.url)}</a></div>`;
      } else $('evResult').innerHTML = `<div class="meta">No guide for "${escapeHTML(key)}". Admins can add guides.</div>`;
    });

    // admin manage data (simple)
    $('manageData').addEventListener('click', ()=> {
      if(CURRENT_USER.role !== 'ADMIN'){ alert('Admin only'); return; }
      alert('Use the Add buttons on each page to manage data. HazMat import available under Manage Haz.');
    });

    // weather (NWS)
    async function fetchWeather(){
      try{
        const r = await fetch('https://api.weather.gov/alerts/active?area=OSW');
        const j = await r.json();
        if(j && Array.isArray(j.features) && j.features.length) $('weatherBlock').textContent = j.features.map(f=> `${f.properties.event} — ${f.properties.areaDesc}`).join('\\n\\n');
        else $('weatherBlock').textContent = 'No active alerts';
      } catch(e){ $('weatherBlock').textContent = 'Weather service unavailable'; }
    }

    // small util
    function escapeHTML(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;'); }

    // done
  </script>
</body>
</html>

